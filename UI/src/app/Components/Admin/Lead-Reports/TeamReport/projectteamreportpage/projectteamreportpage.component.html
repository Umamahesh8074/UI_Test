<div class="head">Sales and Presales Report</div>
<div>
  <form class="example-form" [formGroup]="formData">

    <mat-form-field appearance="outline" style="width: 20%; padding-left: 10px;">
      <input type="text" placeholder="Select Projects" aria-label="Select projects" matInput
        [matAutocomplete]="projectAuto" [formControl]="project" (input)="searchProject($event)" />
    </mat-form-field>

    <mat-autocomplete #projectAuto="matAutocomplete">
      <mat-option> <mat-checkbox #allProjectSelected (click)="onAllSelectProject()"
          [checked]="isProjectAllSelected()">All</mat-checkbox></mat-option>
      <mat-option *ngFor="let project of projects" (click)="$event.preventDefault()">
        <div (click)="$event.stopPropagation()">

          <mat-checkbox [checked]="isSelectedProject(project.projectId)" (change)="onProjectSelect(project, $event)"
            (click)="$event.stopPropagation()">
            {{ project.projectName }}
          </mat-checkbox>
        </div>
      </mat-option>
    </mat-autocomplete>
    <button mat-icon-button matSuffix (click)="onProjectSelectButtonClick()" type="button">
      <mat-icon>search</mat-icon>
    </button>

    <!-- <div style="margin: 0 10px" *ngIf="isDisplay()">
      <mat-form-field appearance="outline" class="example-full-width">
        <mat-label>Select Team</mat-label>
        <mat-select (selectionChange)="handleSaleTeamSelect($event.value)">
          <mat-option *ngIf="projectId" [value]="">All</mat-option>
          <mat-option *ngFor="let team of salesTeams" [value]="team">
            {{ team.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div> -->
    <div *ngIf="isDisplay()">
      <mat-form-field class="example-full-width" appearance="outline">
        <mat-label>Search/Select User</mat-label>
        <input type="text" matInput aria-label="Number" (input)="onUserSerach($any($event).target?.value)"
          [formControl]="user" [matAutocomplete]="auto1" />

        <mat-autocomplete #auto1="matAutocomplete" (optionSelected)="onUserSelete($event)" [displayWith]="displayUser">
          <mat-option [value]=""> All </mat-option>
          <mat-option *ngFor="let user of userListByManagerId" [value]="user">
            {{ user.userName }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

    </div>

    <div style="margin: 0 10px">
      <mat-form-field appearance="outline">
        <mat-label>Select Day</mat-label>
        <mat-select [(value)]="selectedDay" (selectionChange)="handleDaySelection($event.value)">
          <mat-option *ngFor="let day of days" [value]="day">
            {{ day.commonRefValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div style="margin: 0 10px">
      <mat-form-field *ngIf="showDateRangePicker" class="time-picker" appearance="outline">
        <mat-label>Select Date Range</mat-label>
        <mat-date-range-input [rangePicker]="picker" (click)="picker.open()">
          <input matStartDate placeholder="Start date" formControlName="customStartDate" (focus)="picker.open()" />
          <input matEndDate placeholder="End date" formControlName="customEndDate" (focus)="picker.open()" />
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>
    </div>
  </form>
</div>
<mat-card>
  <table class="tree-table">
    <thead>
      <tr>
        <th class="row-heads">Leads</th>
        <th class="row-heads">Project</th>
        <th class="row-heads">User</th>
        <th class="row-heads">Assign Leads</th>
        <th class="row-heads">New Leads</th>
        <th class="row-heads">Unassigned Leads</th>
        <th class="row-heads">Junk</th>
        <th class="row-heads">Non Contactable</th>
        <th class="row-heads">SV Done</th>
        <th class="row-heads">Sales Follow-Up</th>
        <th class="row-heads">Sales Lost</th>
        <th class="row-heads">Sales Non-Contactable</th>
        <th class="row-heads">Sales Junk</th>
        <th class="row-heads">Sales DND</th>
        <th class="row-heads">Booked</th>
        <th class="row-heads">Cancelled Booking</th>
        <th class="row-heads">Lost</th>
        <th class="row-heads">Follow-Up</th>
        <th class="row-heads">Qualified</th>
        <th class="row-heads">SV Confirm</th>
        <th class="row-heads">Visit Prospect</th>
        <th class="row-heads">Revisit Proposed</th>
        <th class="row-heads">Revisit Done</th>
        <th class="row-heads">EOI Received</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let node of treeData; let i = index">
        <!-- Parent Node (Leads) -->
        <tr [ngClass]="{ 'main-row-active': isActive(getUniqueId(node, i)) }" style="cursor: cell">
          <td (click)="toggle(getUniqueId(node, i))" style="display: flex">
            <mat-icon class="menu-icon" *ngIf="node.children && node.children.length > 0">
              {{ isExpanded(getUniqueId(node, i)) ? "remove" : "add" }}
            </mat-icon>
            {{ node.name }}
          </td>
          <td></td>
          <td></td>

          <td>{{ node.assignedLeads || "0" }}</td>
          <td>{{ node.newLeads || "0" }}</td>
          <td>{{ node.unassignedLeads || "0" }}</td>
          <td>{{ node.junk || "0" }}</td>
          <td>{{ node.nonContactable || "0" }}</td>
          <td>{{ node.siteVisitDone || "0" }}</td>
          <td>{{ node.salesFollowUp || "0" }}</td>
          <td>{{ node.salesLost || "0" }}</td>
          <td>{{ node.salesNoncontactable || "0" }}</td>
          <td>{{ node.salesDND || "0" }}</td>
          <td>{{ node.salesJunk || "0" }}</td>
          <td>{{ node.booked || "0" }}</td>
          <td>{{ node.cancelledBooking || "0" }}</td>
          <td>{{ node.lost || "0" }}</td>
          <td>{{ node.followUp || "0" }}</td>
          <td>{{ node.qualified || "0" }}</td>
          <td>{{ node.siteVisitConfirm || "0" }}</td>
          <td>{{ node.visitProspect || "0" }}</td>
          <td>{{ node.reVisitProposed || "0" }}</td>
          <td>{{ node.reVisitDone || "0" }}</td>
          <td>{{ node.eoiReceivedStatus || "0" }}</td>
        </tr>
        <!-- Child Nodes -->
        <ng-container *ngIf="node.children && isExpanded(getUniqueId(node, i))">
          <ng-container *ngFor="let child of node.children; let j = index">
            <tr [ngClass]="{
                'child-row-active': isActive(getUniqueId(child, i, j))
              }" style="cursor: cell">
              <td></td>
              <td (click)="toggle(getUniqueId(child, i, j))" style="display: flex">
                <mat-icon class="menu-icon" *ngIf="child.children && child.children.length > 0">
                  {{ isExpanded(getUniqueId(child, i, j)) ? "remove" : "add" }}
                </mat-icon>
                {{ child.name }}
              </td>

              <td></td>
              <td>{{ child.assignedLeads || "0" }}</td>
              <td>{{ child.newLeads || "0" }}</td>
              <td>{{ child.unassignedLeads || "0" }}</td>
              <td>{{ child.junk || "0" }}</td>
              <td>{{ child.nonContactable || "0" }}</td>
              <td>{{ child.siteVisitDone || "0" }}</td>
              <td>{{ child.salesFollowUp || "0" }}</td>
              <td>{{ child.salesLost || "0" }}</td>
              <td>{{ child.salesNoncontactable || "0" }}</td>
              <td>{{ child.salesDND || "0" }}</td>
              <td>{{child.salesJunk || "0" }}</td>
              <td>{{ child.booked || "0" }}</td>
              <td>{{ child.cancelledBooking || "0" }}</td>
              <td>{{ child.lost || "0" }}</td>
              <td>{{ child.followUp || "0" }}</td>
              <td>{{ child.qualified || "0" }}</td>
              <td>{{ child.siteVisitConfirm || "0" }}</td>
              <td>{{ child.visitProspect || "0" }}</td>
              <td>{{ child.reVisitProposed || "0" }}</td>
              <td>{{ child.reVisitDone || "0" }}</td>
              <td>{{ child.eoiReceivedStatus || "0" }}</td>
            </tr>
            <!-- Sub-child Nodes -->
            <ng-container *ngIf="child.children && isExpanded(getUniqueId(child, i, j))">
              <ng-container *ngFor="let subchild of child.children; let k = index">
                <tr [ngClass]="{
                    'sub-child-row-active': isActive(
                      getUniqueId(subchild, i, j, k)
                    )
                  }">
                  <td></td>
                  <td></td>
                  <td (click)="toggle(getUniqueId(subchild, i, j, k))" style="display: flex">
                    <mat-icon class="menu-icon" *ngIf="subchild.children && subchild.children.length > 0">
                      {{
                      isExpanded(getUniqueId(subchild, i, j, k))
                      ? "remove"
                      : "add"
                      }}
                    </mat-icon>
                    {{ subchild.name }}
                  </td>

                  <td>{{ subchild.assignedLeads || "0" }}</td>
                  <td>{{ subchild.newLeads || "0" }}</td>
                  <td>{{ subchild.unassignedLeads || "0" }}</td>
                  <td>{{ subchild.junk || "0" }}</td>
                  <td>{{ subchild.nonContactable || "0" }}</td>
                  <td>{{ subchild.siteVisitDone || "0" }}</td>
                  <td>{{ subchild.salesFollowUp || "0" }}</td>
                  <td>{{ subchild.salesLost || "0" }}</td>
                  <td>{{ subchild.salesNoncontactable || "0" }}</td>
                  <td>{{ subchild.salesDND || "0" }}</td>
                  <td>{{ subchild.salesJunk || "0" }}</td>
                  <td>{{ subchild.booked || "0" }}</td>
                  <td>{{ subchild.cancelledBooking || "0" }}</td>
                  <td>{{ subchild.lost || "0" }}</td>
                  <td>{{ subchild.followUp || "0" }}</td>
                  <td>{{ subchild.qualified || "0" }}</td>
                  <td>{{ subchild.siteVisitConfirm || "0" }}</td>
                  <td>{{ subchild.visitProspect || "0" }}</td>
                  <td>{{ subchild.reVisitProposed || "0" }}</td>
                  <td>{{ subchild.reVisitDone || "0" }}</td>
                  <td>{{ subchild.eoiReceivedStatus || "0" }}</td>
                </tr>
                <!-- Further Sub-child Nodes (if any) -->
              </ng-container>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
    </tbody>
  </table>
</mat-card>