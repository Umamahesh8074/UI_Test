<h2 class="header"><b>Generate Sales Agreement </b></h2>

<form [formGroup]="formData">
  <div class="example-container">
    <mat-card class="ajna-consmp-card">
      <mat-card-header>
        <b>{{
          isAdding
            ? "ADD Sales Agreement Fields"
            : "EDIT Sales Agreement Fields"
        }}</b>
      </mat-card-header>

      <mat-card-content class="cmn-mat-card-content">
        <div>
          <!-- Project Input Field with Autocomplete -->
          <mat-form-field class="form-field" appearance="outline">
            <mat-label>Project</mat-label>
            <input
              type="text"
              matInput
              [value]="
                selectedProject.projectName ? selectedProject.projectName : ''
              "
              (input)="searchProject($event)"
              [formControl]="project"
              [matAutocomplete]="projectAuto"
            />
            <mat-autocomplete
              #projectAuto="matAutocomplete"
              (optionSelected)="onProjectSelect($event)"
              [displayWith]="displayProject"
            >
              <mat-option value="">All</mat-option>
              <mat-option *ngFor="let option of projects" [value]="option">
                {{ option.projectName }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>

          <mat-form-field class="form-field" appearance="outline">
            <mat-label>Select Template</mat-label>
            <mat-select
              formControlName="salesAggrementTemplateId"
              (selectionChange)="onTemplateSelect($event)"
            >
              <mat-option
                *ngFor="let temp of templates"
                [value]="temp.salesAggrementTemplateId"
              >
                {{ temp.salesAggrementTemplateName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <!-- <div class="flat-number-container"> -->

          <!-- <mat-form-field appearance="outline" class="form-field">
            <mat-label>Flat Number</mat-label>
            <input
              matInput
              formControlName="flatNumber"
              type="text"
              placeholder="Enter flat number"
            />
          </mat-form-field> -->

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Flat Number</mat-label>
            <input
              matInput
              formControlName="flatNumber"
              type="text"
              placeholder="Enter flat number"
            />
          </mat-form-field>

          <button mat-flat-button color="primary" (click)="getFlatDetails()">
            Fill Fields
          </button>
          <!-- </div> -->
        </div>

        <!-- <div formGroupName="dynamicFields" class="fields-container">
          <div *ngFor="let field of fields" class="field-item">
            <mat-form-field appearance="outline" class="example-full-width">
              <mat-label>{{
                field.processedPlaceholder && field.processedPlaceholder.trim()
                  ? field.processedPlaceholder
                  : field.templateFields
              }}</mat-label>
              <input
                matInput
                *ngIf="formData.get('dynamicFields')?.get(field.templateFields)"
                [formControlName]="field.templateFields"
                [id]="field.templateFields"
                [type]="field.type || 'text'"
                [placeholder]="
                  field.processedPlaceholder &&
                  field.processedPlaceholder.trim()
                    ? field.processedPlaceholder
                    : field.templateFields
                "
              />
            </mat-form-field>
          </div>
        </div> -->

        <!-- Dynamic Fields -->
        <div formGroupName="dynamicFields" class="fields-container">
          <div *ngFor="let field of fields" class="field-item">
            <mat-form-field appearance="outline" class="example-full-width">
              <mat-label>
                {{
                  field.processedPlaceholder &&
                  field.processedPlaceholder.trim()
                    ? field.processedPlaceholder
                    : field.templateFields
                }}
              </mat-label>
              <input
                matInput
                *ngIf="formData.get('dynamicFields')?.get(field.templateFields)"
                [formControlName]="field.templateFields"
                [id]="field.templateFields"
                [type]="field.type || 'text'"
                [placeholder]="
                  field.processedPlaceholder &&
                  field.processedPlaceholder.trim()
                    ? field.processedPlaceholder
                    : field.templateFields
                "
              />

              <!-- Show validation message only for mandatory fields with errors -->
              <mat-error
                *ngIf="
                  field.isMandatory &&
                  formData
                    .get('dynamicFields')
                    ?.get(field.templateFields)
                    ?.hasError('required')
                "
              >
                {{
                  field.processedValidateMessage ||
                    field.templateFields + " is required."
                }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>

      <mat-card-footer class="add-mat-card-footer">
        <div>
          <!-- Add/Update and Reset Buttons -->
          <ng-container *ngIf="!isView">
            <button
              mat-flat-button
              class="btn-class primary"
              (click)="generateData()"
            >
              {{ isAdding ? "Generate" : "UPDATE" }}
            </button>
            <!-- <button
              mat-flat-button
              type="button"
              class="btn-class warn"
              (click)="clearForm()"
            >
              RESET
            </button> -->
            <button
              mat-flat-button
              class="btn-class accent"
              type="button"
              (click)="gotobooking()"
            >
              BACK
            </button>
          </ng-container>
        </div>
      </mat-card-footer>
    </mat-card>
  </div>
</form>
