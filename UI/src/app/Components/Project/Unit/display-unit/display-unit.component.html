<div class="pac-header">
  <div class="center">UNIT</div>
  <div class="right">
    <button
      mat-flat-button
      class="btn-class-home"
      id="goBack"
      style="background-color: rgb(97, 97, 38); color: white; width: 8rem"
      (click)="goBack()"
    >
      Go To Home
    </button>
  </div>
</div>
<div class="example-button-row">
  <div class="search-container">
    <mat-form-field appearance="outline" class="search-class">
      <mat-label>Search On Unit Name</mat-label>
      <input
        matInput
        (input)="onSearch($any($event).target?.value)"
        placeholder="Enter Unit Name"
      />
    </mat-form-field>

    <mat-form-field appearance="outline" class="search-class ml-2">
      <input
        type="text"
        placeholder="Select Projects"
        aria-label="Select projects"
        matInput
        [matAutocomplete]="projectAuto"
        [formControl]="project"
        (input)="searchProject($event)"
      />
    </mat-form-field>

    <mat-autocomplete #projectAuto="matAutocomplete">
      <mat-option>
        <mat-checkbox
          #allProjectSelected
          (click)="onAllSelectProject()"
          [checked]="isProjectAllSelected()"
          >All</mat-checkbox
        ></mat-option
      >
      <mat-option
        *ngFor="let umproject of userManageprojects"
        (click)="$event.preventDefault()"
      >
        <div (click)="$event.stopPropagation()">
          <mat-checkbox
            [checked]="isSelectedProject(umproject.projectId, umproject.id)"
            (change)="onProjectSelect(umproject, $event)"
            (click)="$event.stopPropagation()"
          >
            {{ umproject.projectName }}
          </mat-checkbox>
        </div>
      </mat-option>
    </mat-autocomplete>
    <button
      mat-icon-button
      matSuffix
      (click)="onProjectSelectButtonClick()"
      type="button"
      style="margin-left: -3px"
    >
      <mat-icon>search</mat-icon>
    </button>

    <!-- BLOCK -->
    <mat-form-field appearance="outline" class="search-class ml-2">
      <input
        type="text"
        placeholder="Select Block"
        aria-label="Select Blocks"
        matInput
        [matAutocomplete]="blockAuto"
        [formControl]="block"
        (input)="searchBlock($event)"
      />
    </mat-form-field>

    <mat-autocomplete #blockAuto="matAutocomplete">
      <mat-option>
        <mat-checkbox
          #allBlockSelected
          (click)="onAllSelectBlock()"
          [checked]="isBlockAllSelected()"
          >All</mat-checkbox
        ></mat-option
      >
      <mat-option
        *ngFor="let block of blocks"
        (click)="$event.preventDefault()"
      >
        <div (click)="$event.stopPropagation()">
          <mat-checkbox
            [checked]="isSelectedBlock(block.id)"
            (change)="onBlockSelect(block, $event)"
            (click)="$event.stopPropagation()"
          >
            {{ block.name + " ( " + block.projectCode + " )" }}
          </mat-checkbox>
        </div>
      </mat-option>
    </mat-autocomplete>
    <button
      mat-icon-button
      matSuffix
      (click)="onBlockSelectButtonClick()"
      type="button"
      style="margin-left: -3px"
    >
      <mat-icon>search</mat-icon>
    </button>
    <!-- STATUS -->
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Select Status</mat-label>
      <mat-select
        [(value)]="selectedStatus"
        (selectionChange)="onStatusSelect($event.value)"
      >
        <mat-option *ngFor="let element of status" [value]="element.name">
          {{ element.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Unit Belongs To</mat-label>
      <mat-select
        (selectionChange)="onUnitTypeBelongsChange($event)"
        [(ngModel)]="typeId"
      >
        <mat-option *ngFor="let element of companyType" [value]="element.id">
          {{ element.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div class="buttons">
    <div>
      <button
        mat-flat-button
        style="color: white; background-color: #004869"
        (click)="addUnit()"
        class="btn-class"
      >
        <mat-icon class="font">add</mat-icon> ADD
      </button>
    </div>
  </div>
</div>

<mat-card class="cmn-card">
  <mat-card-content class="cmn-card-content">
    <div class="tab-head">
      <table
        matSort
        mat-table
        [dataSource]="unitsData"
        class="mat-elevation-z8"
      >
        <!-- <ng-container matColumnDef="name">
          <th
            mat-header-cell
            *matHeaderCellDef
            style="background-color: #004869; color: white"
          >
            Unit
          </th>
          <td mat-cell *matCellDef="let unit">{{ unit.id }}</td>
        </ng-container> -->

        <ng-container matColumnDef="projectName">
          <th mat-header-cell *matHeaderCellDef>Project Name</th>
          <td mat-cell *matCellDef="let unit">{{ unit.projectName }}</td>
        </ng-container>
        <ng-container matColumnDef="blockName">
          <th mat-header-cell *matHeaderCellDef>Block Name</th>
          <td mat-cell *matCellDef="let unit">{{ unit.blockName }}</td>
        </ng-container>
        <ng-container matColumnDef="levelName">
          <th mat-header-cell *matHeaderCellDef>Level Name</th>
          <td mat-cell *matCellDef="let unit">{{ unit.levelName }}</td>
        </ng-container>
        <ng-container matColumnDef="unitName">
          <th mat-header-cell *matHeaderCellDef>Unit Name</th>
          <td mat-cell *matCellDef="let unit">{{ unit.unitName }}</td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let unit">{{ unit.status }}</td>
        </ng-container>

        <ng-container matColumnDef="blockedByName">
          <th mat-header-cell *matHeaderCellDef>Booked/Blocked By</th>
          <td mat-cell *matCellDef="let unit">{{ unit.blockedByName }}</td>
        </ng-container>
        <ng-container matColumnDef="firstApplicantName">
          <th mat-header-cell *matHeaderCellDef>Allocated To</th>
          <td mat-cell *matCellDef="let unit">{{ unit.firstApplicantName }}</td>
        </ng-container>
        <ng-container matColumnDef="companyType">
          <th mat-header-cell *matHeaderCellDef>Unit Belongs To</th>
          <td mat-cell *matCellDef="let unit">{{ unit.companyTypeName }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let unit" class="mat-icon-actions">
            <mat-icon
              matTooltip="Edit Customer Payment"
              (click)="editUnit(unit)"
              class="action-icon"
              >edit</mat-icon
            >
            <mat-icon
              *ngIf="unit.status == 'Available'"
              matTooltip="Block Unit"
              class="action-icon"
              >exit_to_app</mat-icon
            >
            <!-- (click)="gotoBooking(unit)" -->
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let unit of unitsData; columns: displayedColumns"
        ></tr>
      </table>
    </div>
  </mat-card-content>
  <mat-card-footer>
    <mat-paginator
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
      class="custom-paginator"
    ></mat-paginator>
  </mat-card-footer>
</mat-card>
