<h4 class="pac-header">
  {{ isAdding ? "ADD STORE" : "EDIT STORE" }}
</h4>

<form [formGroup]="formData" (ngSubmit)="onSubmit()">
  <div class="example-container">
    <mat-card class="card">
      <mat-card-content class="cmn-mat-card-content">
        <!-- Store Name -->
        <mat-form-field appearance="outline" class="mat-50">
          <mat-label>Name</mat-label>
          <input matInput formControlName="storeName" />
          <mat-error *ngIf="formData.get('storeName')?.hasError('required')"
            >Name is required</mat-error
          >
        </mat-form-field>

        <!-- Contact Number -->
        <mat-form-field appearance="outline" class="mat-50">
          <mat-label>Contact Number</mat-label>
          <input matInput formControlName="contactNumber" />
        </mat-form-field>

        <!-- Billing Address -->
        <mat-form-field appearance="outline" class="mat-50">
          <mat-label>Billing Address</mat-label>
          <input matInput formControlName="billingAddress" />
        </mat-form-field>

        <!-- Billing GST Number -->
        <mat-form-field appearance="outline" class="mat-50">
          <mat-label>Billing GST Number</mat-label>
          <input matInput formControlName="billingGstNumber" />
        </mat-form-field>

        <!-- Search/Select Project -->
        <!-- <mat-form-field appearance="outline" class="mat-50">
          <mat-label>Search/Select Project</mat-label>
          <input
            type="text"
            matInput
            [value]="
              selectedProject.projectName ? selectedProject.projectName : ''
            "
            (input)="searchProject($event)"
            [formControl]="projectFc"
            [matAutocomplete]="projectAuto"
          />
          <mat-autocomplete
            #projectAuto="matAutocomplete"
            (optionSelected)="onProjectSelect($event)"
            [displayWith]="displayProject"
          >
            <mat-option *ngFor="let option of project" [value]="option">
              {{ option.projectName }}
            </mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="projectFc.hasError('required')">
            Select Project
          </mat-error>
        </mat-form-field> -->


        <ng-container *ngIf="!isEditMode; else readOnlyProject">
          <mat-form-field appearance="outline" class="mat-50">
            <mat-label>Search/Select Project</mat-label>
            <input
              type="text"
              matInput
              [value]="selectedProject.projectName || ''"
              (input)="searchProject($event)"
              [formControl]="projectFc"
              [matAutocomplete]="projectAuto"
            />
            <mat-autocomplete
              #projectAuto="matAutocomplete"
              (optionSelected)="onProjectSelect($event)"
              [displayWith]="displayProject"
            >
              <mat-option *ngFor="let option of project" [value]="option">
                {{ option.projectName }}
              </mat-option>
            </mat-autocomplete>
            <mat-error *ngIf="projectFc.hasError('required')">
              Select Project
            </mat-error>
          </mat-form-field>
        </ng-container>
        
        <ng-template #readOnlyProject>
          <mat-form-field appearance="outline" class="mat-50">
            <mat-label>Selected Project</mat-label>
            <input matInput [value]="selectedProject.projectName" disabled />
          </mat-form-field>
        </ng-template>
        
        <!-- In Charges -->



        <mat-form-field appearance="outline" class="mat-50">
          <mat-label>In Charge</mat-label>
          <mat-select
            [formControl]="userFc"
            multiple
            (selectionChange)="onInChargesSelect()"
            [compareWith]="compareInCharger"
          >
            <mat-select-trigger>
              {{ getSelectedInchargesNames() }}
            </mat-select-trigger>
            <mat-option *ngFor="let user of users" [value]="user">
              {{ user.userName }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="userFc.hasError('required')">
            Select Incharge
          </mat-error>
        </mat-form-field>
        <mat-form-field
          class="mat-50"
          appearance="outline"
          style="padding-left: 10px; padding-right: 10px"
        >
          <mat-label>Select Indent Creator</mat-label>
          <input
            type="text"
            placeholder="Search Indent Creator"
            matInput
            [matAutocomplete]="indentCreatorAuto"
            [formControl]="indentCreatorSearchControl"
            (input)="searchIndentCreator($event)"
            (focus)="onInputFocus()"
          />

          <mat-autocomplete
            #indentCreatorAuto="matAutocomplete"
            autoActiveFirstOption
          >
            <mat-option
              *ngFor="let user of filteredIndentCreators"
              (click)="$event.preventDefault()"
            >
              <div (click)="$event.stopPropagation()">
                <mat-checkbox
                  [checked]="isIndentCreatorSelected(user.userId)"
                  (change)="onIndentCreatorChange(user, $event)"
                  (click)="$event.stopPropagation()"
                >
                  {{ user.userName }}
                </mat-checkbox>
              </div>
            </mat-option>
          </mat-autocomplete>

          <mat-error *ngIf="indentCreatorFc.hasError('required')">
            Select at least one Indent Creator
          </mat-error>
        </mat-form-field>
        <mat-form-field
          appearance="outline"
          class="mat-50"
          style="padding-left: 10px; padding-right: 10px"
        >
          <mat-label>Select Quotation Creator</mat-label>
          <input
            type="text"
            placeholder="Search Quotation Creator"
            matInput
            [matAutocomplete]="quotationCreatorAuto"
            [formControl]="quotationCreatorSearchControl"
            (input)="searchQuotationCreator($event)"
          />

          <mat-autocomplete
            #quotationCreatorAuto="matAutocomplete"
            autoActiveFirstOption
          >
            <mat-option
              *ngFor="let user of filteredQuotationCreators"
              (click)="$event.preventDefault()"
            >
              <div (click)="$event.stopPropagation()">
                <mat-checkbox
                  [checked]="isQuotationCreatorSelected(user.userId)"
                  (change)="onQuotationCreatorChange(user, $event)"
                  (click)="$event.stopPropagation()"
                >
                  {{ user.userName }}
                </mat-checkbox>
              </div>
            </mat-option>
          </mat-autocomplete>

          <mat-error *ngIf="quotationCreatorFc.hasError('required')">
            Select at least one Quotation Creator
          </mat-error>
        </mat-form-field>

        <mat-form-field
          appearance="outline"
          class="mat-50"
          style="padding-left: 10px; padding-right: 10px"
        >
          <mat-label>Purchase Order Creator</mat-label>
          <input
            type="text"
            matInput
            placeholder="Search PO Creator"
            [formControl]="poCreatorSearchControl"
            [matAutocomplete]="poCreatorAuto"
            (input)="searchPoCreator($event)"
          />

          <mat-autocomplete
            #poCreatorAuto="matAutocomplete"
            autoActiveFirstOption
          >
            <mat-option
              *ngFor="let user of filteredPoCreators"
              (click)="$event.preventDefault()"
            >
              <div (click)="$event.stopPropagation()">
                <mat-checkbox
                  [checked]="isPoCreatorSelected(user.userId)"
                  (change)="onPoCreatorChange(user, $event)"
                  (click)="$event.stopPropagation()"
                >
                  {{ user.userName }}
                </mat-checkbox>
              </div>
            </mat-option>
          </mat-autocomplete>

          <mat-error *ngIf="poCreatorFc.hasError('required')">
            Select Purchase Order Creator
          </mat-error>
        </mat-form-field>
      </mat-card-content>

      <mat-card-footer class="add-mat-card-footer">
        <div>
          <button
            mat-flat-button
            class="btn-class accent"
            (click)="gotoStore()"
          >
            BACK
          </button>

          <button
            *ngIf="isAdding"
            mat-flat-button
            class="btn-class warn"
            (click)="clearForm()"
          >
            RESET
          </button>
          <button mat-flat-button class="btn-class primary">
            {{ isAdding ? "ADD" : "UPDATE" }}
          </button>
        </div>
      </mat-card-footer>
    </mat-card>
  </div>
</form>
