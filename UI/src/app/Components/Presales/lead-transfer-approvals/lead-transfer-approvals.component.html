<div class="header">LEAD TRANSFER APPROVALS</div>

<div class="filters-div">
  <!-- <div class="search-container">

        <mat-form-field class="search-class ml-2" appearance="outline">
            <mat-label> Search/Select Project Name </mat-label>
            <input type="text" matInput (input)="searchProject($event)" [formControl]="project"
                [matAutocomplete]="projectAuto" />
            <mat-autocomplete #projectAuto="matAutocomplete" (optionSelected)="onProjectSelect($event)"
                [displayWith]="displayProject">
                <mat-option *ngFor="let option of projects" [value]="option">
                    {{ option.displayProjectName }}
                </mat-option>
            </mat-autocomplete>
        </mat-form-field>

        <mat-form-field appearance="outline" class="serach-class ml-2">
            <mat-label>Search On Stage Owner</mat-label>
            <input matInput [(ngModel)]="stageOwnerName" (input)="onSearchStageOwner($any($event).target?.value)"
                placeholder="Enter Stage Owner " />
        </mat-form-field>

        <mat-form-field appearance="outline" class="search-class ml-2">
            <mat-label>Select Status</mat-label>
            <mat-select [(ngModel)]="selectedStatus" (selectionChange)="onStatusChange($event.value)">
                <mat-option *ngFor="let element of status" [value]="element.value">
                    {{ element.value }}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="search-class-date ml-2">
            <mat-label>Select Date Range</mat-label>
            <mat-date-range-input [formGroup]="formData" [rangePicker]="picker" (click)="picker.open()">
                <input matStartDate placeholder="Start date" formControlName="customStartDate" (focus)="picker.open()"
                    (dateChange)="onDateChange()" />
                <input matEndDate placeholder="End date" formControlName="customEndDate" (focus)="picker.open()"
                    (dateChange)="onDateChange()" />
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>

        <mat-icon matTooltip="Clear Date" (click)="clearDateRange()" class="clear-date-div">sync</mat-icon>

        <mat-icon matTooltip="Clear Filters" (click)="resetForm()" class="clear-date-div">filter_list_off</mat-icon>
    </div> -->
</div>

<mat-card class="cmn-card" id="cmn-card">
  <mat-card-content class="cmn-card-content">
    <div class="tab-head">
      <table
        matSort
        mat-table
        [dataSource]="leadTransferForApprovals"
        class="mat-elevation-z8"
      >
        <ng-container matColumnDef="opportunityId">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.opportunityId }}
          </td>
        </ng-container>

        <ng-container matColumnDef="customerName">
          <th mat-header-cell *matHeaderCellDef>Customer Name</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.leadName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="customerPhNo">
          <th mat-header-cell *matHeaderCellDef>Customer Ph No</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.leadPhoneNumber }}
          </td>
        </ng-container>

        <ng-container matColumnDef="project">
          <th mat-header-cell *matHeaderCellDef>Project</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.projectName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="ProjectName">
          <th mat-header-cell *matHeaderCellDef>Project Name</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.projecName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="currentSource">
          <th mat-header-cell *matHeaderCellDef>Current Source</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.existingSourceName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="currentSubSource">
          <th mat-header-cell *matHeaderCellDef>Current Sub Source</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.existingSubSourceName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="createdDate">
          <th mat-header-cell *matHeaderCellDef>Customer Created date</th>
          <td
            mat-cell
            *matCellDef="let approvals"
            matTooltip="{{ approvals.leadCreatedDate | date : 'medium' }}"
          >
            {{ approvals.leadCreatedDate | date : "mediumDate" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="leadStatus">
          <th mat-header-cell *matHeaderCellDef>Customer Status</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.leadStatus }}
          </td>
        </ng-container>
        <ng-container matColumnDef="requestedSource">
          <th mat-header-cell *matHeaderCellDef>Requested Source</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.requsetedSourceName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="requestedSubSource">
          <th mat-header-cell *matHeaderCellDef>Requested Sub Source</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.requestedSubSourceName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="whoRequested">
          <th mat-header-cell *matHeaderCellDef>Requested By</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.whoRequested }}
          </td>
        </ng-container>

        <ng-container matColumnDef="requestedDate">
          <th mat-header-cell *matHeaderCellDef>Requested Date</th>
          <td
            mat-cell
            *matCellDef="let approvals"
            matTooltip="{{ approvals.approvalSendDate | date : 'medium' }}"
          >
            {{ approvals.approvalSendDate | date : "mediumDate" }}
          </td>
        </ng-container>

        <ng-container matColumnDef="presentStage">
          <th mat-header-cell *matHeaderCellDef>Current Stage</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.stageName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="approver">
          <th mat-header-cell *matHeaderCellDef>Approver</th>
          <td mat-cell *matCellDef="let approvals">
            {{ approvals.approver }}
          </td>
        </ng-container>

        <ng-container matColumnDef="stageStatus">
          <th mat-header-cell *matHeaderCellDef>Lead Transfer Status</th>
          <td
            mat-cell
            *matCellDef="let approvals"
            [ngClass]="getStatusClass(approvals.stageStatus)"
          >
            {{ approvals.stageStatus }}
          </td>
        </ng-container>
        <ng-container matColumnDef="transferStatus">
          <th mat-header-cell *matHeaderCellDef>Stage Status</th>
          <td
            mat-cell
            *matCellDef="let approvals"
            [ngClass]="getStatusClass(approvals.status)"
          >
            {{ approvals.status }}
          </td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let approvals">
            <mat-icon
              matTooltip="Approve/Reject Lead Transfer"
              (click)="displayApprovalDetails(approvals)"
              class="font icon-spacing icon"
              style="color: purple; cursor: pointer"
              >rule</mat-icon
            >
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </mat-card-content>
  <mat-card-footer>
    <mat-paginator
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
    ></mat-paginator>
  </mat-card-footer>
</mat-card>

<div id="leadApproval" *ngIf="openApprovalDialog">
  <div mat-dialog-content class="approval-dialog-container">
    <div class="approval-dialog-header">
      <span class="dialog-title">Approve/Reject Lead Transfer</span>
      <button class="close-btn" type="button" (click)="onBack()">
        &times;
      </button>
    </div>
    <div class="approval-dialog-details">
      <div class="detail-row">
        <mat-icon class="detail-icon" color="primary">person</mat-icon>
        <span class="detail-label">Customer:</span>
        <span class="detail-value">{{ selectedApproval?.leadName }}</span>
      </div>
      <div class="detail-row">
        <mat-icon class="detail-icon" color="accent">phone</mat-icon>
        <span class="detail-label">Phone:</span>
        <span class="detail-value">{{
          selectedApproval?.leadPhoneNumber
        }}</span>
      </div>
      <div class="detail-row">
        <mat-icon class="detail-icon" color="primary">apartment</mat-icon>
        <span class="detail-label">Project:</span>
        <span class="detail-value">{{
          selectedApproval?.projectName || selectedApproval?.projecName
        }}</span>
      </div>
      <div class="detail-row">
        <mat-icon class="detail-icon" color="accent">event</mat-icon>
        <span class="detail-label">Requested On:</span>
        <span class="detail-value">{{
          selectedApproval?.approvalSendDate | date : "medium"
        }}</span>
      </div>
      <div class="detail-row">
        <mat-icon class="detail-icon" color="primary">person_search</mat-icon>
        <span class="detail-label">Requested By:</span>
        <span class="detail-value">{{ selectedApproval?.whoRequested }}</span>
      </div>
      <div class="detail-row">
        <mat-icon class="detail-icon" color="accent">swap_horiz</mat-icon>
        <span class="detail-label">Current Source:</span>
        <span class="detail-value">{{
          selectedApproval?.existingSourceName
        }}</span>
      </div>
      <div class="detail-row">
        <mat-icon class="detail-icon" color="primary">source</mat-icon>
        <span class="detail-label">Requested Source:</span>
        <span class="detail-value">{{
          selectedApproval?.requsetedSourceName
        }}</span>
      </div>
      <!-- <div class="detail-row">
        <mat-icon class="detail-icon" color="accent">flag</mat-icon>
        <span class="detail-label">Status:</span>
        <span class="detail-value">{{ selectedApproval?.stageStatus }}</span>
      </div> -->
    </div>
    <div class="button-group approval-dialog-actions">
      <button
        mat-flat-button
        class="btn-class accent"
        type="button"
        (click)="onBack()"
      >
        BACK
      </button>
      <button
        mat-flat-button
        class="btn-class warn"
        type="button"
        (click)="approvalStatus('Rejected')"
      >
        REJECT
      </button>
      <button
        mat-flat-button
        class="btn-class success"
        type="button"
        (click)="approvalStatus('Approval')"
      >
        APPROVE
      </button>
    </div>
  </div>
</div>
