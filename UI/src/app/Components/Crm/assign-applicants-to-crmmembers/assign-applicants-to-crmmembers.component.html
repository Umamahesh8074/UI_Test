<div class="pac-header">ASSIGN CRM</div>
<div>
  <div>
    <div class="example-button-row">
      <!-- <span class="search-container">
        <mat-form-field class="serach-class" appearance="outline" *ngIf="!crmMemberRoleName.includes(roleName)">
          <mat-label>Search/Select Project</mat-label>
          <input
            type="text"
            matInput
            (input)="searchProject($event)"
            [formControl]="project"
            [matAutocomplete]="projectAuto"
          />
          <mat-autocomplete
            #projectAuto="matAutocomplete"
            (optionSelected)="onProjectSelect($event)"
            [displayWith]="displayProject"
          >
            <mat-option *ngFor="let option of projects" [value]="option">
              {{ option.projectName }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </span> -->
      <span>
        <mat-form-field
          appearance="outline"
          class="search-class ml-2"
          style="margin-left: 0.5%"
        >
          <mat-label>Search/Select Block</mat-label>
          <input
            type="text"
            matInput
            (input)="searchBlock($event)"
            [formControl]="block"
            [matAutocomplete]="blockAuto"
          />
          <mat-autocomplete
            #blockAuto="matAutocomplete"
            (optionSelected)="onBlockSelect($event)"
            [displayWith]="displayBlock"
          >
            <mat-option *ngFor="let option of blocks" [value]="option">
              {{ option.name }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </span>
      <span>
        <mat-form-field
          appearance="outline"
          class="search-class ml-2"
          style="margin-left: 0.5%"
        >
          <mat-label>Search/Select Floor</mat-label>
          <input
            type="text"
            matInput
            (input)="searchFloor($event)"
            [formControl]="floor"
            [matAutocomplete]="floorAuto"
          />
          <mat-autocomplete
            #floorAuto="matAutocomplete"
            (optionSelected)="onFloorSelect($event)"
            [displayWith]="displayFloor"
          >
            <mat-option *ngFor="let option of levels" [value]="option">
              {{ option.name }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </span>
      <span class="search-container">
        <mat-form-field class="serach-class" appearance="outline">
          <mat-label>Search/Select Unit</mat-label>
          <input
            type="text"
            [value]="unitName"
            matInput
            (input)="searchUnit($event)"
            [formControl]="unit"
            [matAutocomplete]="unitAuto"
          />
          <mat-autocomplete
            #unitAuto="matAutocomplete"
            (optionSelected)="onUnitSelect($event)"
            [displayWith]="displayUnit"
          >
            <mat-option *ngFor="let option of units" [value]="option">
              {{ option.unitName }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </span>
      <span class="search-container">
        <mat-form-field class="serach-class" appearance="outline">
          <mat-label>Search/Select CRM User</mat-label>
          <input
            type="text"
            matInput
            (input)="searchCrm($event)"
            [formControl]="user"
            [matAutocomplete]="userAuto"
          />
          <mat-autocomplete
            #userAuto="matAutocomplete"
            (optionSelected)="onCrmTeamSelect($event)"
            [displayWith]="displayUser"
          >
            <mat-option value="all">All</mat-option>
            <mat-option *ngFor="let option of userData" [value]="option">
              {{ option.userName }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </span>
      <span class="search-container">
        <mat-form-field class="serach-class" appearance="outline">
          <mat-label>Search/Select Target CRM User</mat-label>
          <input
            type="text"
            matInput
            (input)="searchTargetCrm($event)"
            [formControl]="targetUser"
            [matAutocomplete]="targetUserAuto"
          />
          <mat-autocomplete
            #targetUserAuto="matAutocomplete"
            (optionSelected)="onTargetCrmSelect($event)"
            [displayWith]="displayTargetUser"
          >
            <mat-option value="all">All</mat-option>
            <mat-option *ngFor="let option of targetUserData" [value]="option">
              {{ option.userName }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </span>
    </div>
    <!-- <div class="example-button-row">
  
    </div> -->

    <mat-card class="cmn-card">
      <mat-card-content class="cmn-card-content">
        <div class="tab-head">
          <table
            matSort
            mat-table
            [dataSource]="applicantInfoData"
            class="mat-elevation-z8"
          >
            <ng-container matColumnDef="select">
              <th
                mat-header-cell
                *matHeaderCellDef
                style="
                  overflow: hidden;
                  max-width: 48px;
                  background: #fff;
                  position: relative;
                  z-index: 2;
                "
              >
                <div
                  style="
                    display: flex;
                    align-items: center;
                    width: 100%;
                    height: 100%;
                    position: static;
                    z-index: 2;
                  "
                >
                  <mat-checkbox
                    [checked]="isAllSelected()"
                    [indeterminate]="isSomeSelected()"
                    (click)="$event.stopPropagation(); masterToggle()"
                    style="
                      margin: 0;
                      width: 100%;
                      box-sizing: border-box;
                      position: static;
                      z-index: 2;
                      background: #fff;
                    "
                  ></mat-checkbox>
                </div>
              </th>
              <td
                mat-cell
                *matCellDef="let applicationInfo"
                style="
                  overflow: hidden;
                  max-width: 48px;
                  position: static;
                  z-index: 1;
                "
              >
                <div
                  style="
                    display: flex;
                    align-items: center;
                    width: 100%;
                    height: 100%;
                    position: static;
                    z-index: 1;
                  "
                >
                  <mat-checkbox
                    (click)="
                      $event.stopPropagation(); toggleSelection(applicationInfo)
                    "
                    [checked]="isSelected(applicationInfo)"
                    style="
                      margin: 0;
                      width: 100%;
                      box-sizing: border-box;
                      position: static;
                      z-index: 1;
                    "
                  ></mat-checkbox>
                </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="bookingCode">
              <th mat-header-cell *matHeaderCellDef>Booking Code</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.bookingCode }}
              </td>
            </ng-container>

            <ng-container matColumnDef="firstApplicantName">
              <th mat-header-cell *matHeaderCellDef>Customer Name</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.firstApplicantName }}
              </td>
            </ng-container>

            <ng-container matColumnDef="projectName">
              <th mat-header-cell *matHeaderCellDef>Project</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.projectName }}
              </td>
            </ng-container>
            <ng-container matColumnDef="levelName">
              <th mat-header-cell *matHeaderCellDef>Floor</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.levelName }}
              </td>
            </ng-container>
            <ng-container matColumnDef="towerName">
              <th mat-header-cell *matHeaderCellDef>Tower</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.towerName }}
              </td>
            </ng-container>
            <ng-container matColumnDef="blockName">
              <th mat-header-cell *matHeaderCellDef>Block</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.blockName }}
              </td>
            </ng-container>
            <ng-container matColumnDef="unitName">
              <th mat-header-cell *matHeaderCellDef>Unit</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.unitName }}
              </td>
            </ng-container>
            <ng-container matColumnDef="crmUserName">
              <th mat-header-cell *matHeaderCellDef>CRM User</th>
              <td mat-cell *matCellDef="let applicationInfo">
                {{ applicationInfo.crmUserName }}
              </td>
            </ng-container>
            <ng-container matColumnDef="finalPrice">
              <th mat-header-cell *matHeaderCellDef>
                Total Unit Cost (Including GST)
              </th>
              <td
                mat-cell
                *matCellDef="let applicationInfo"
                [ngClass]="{
                  'blue-amount': applicationInfo.formattedTotalUnitCost
                }"
              >
                {{ applicationInfo.formattedTotalUnitCost }}
              </td>
            </ng-container>
            <ng-container matColumnDef="receivedAmount">
              <th mat-header-cell *matHeaderCellDef>Received Amount</th>
              <td
                mat-cell
                *matCellDef="let applicationInfo"
                [ngClass]="{
                  'green-amount': applicationInfo.formattedReceivedAmount
                }"
              >
                {{ applicationInfo.formattedReceivedAmount }}
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
              class="table-row"
              mat-row
              *matRowDef="
                let applicationInfo of applicantInfoData;
                columns: displayedColumns
              "
            ></tr>
          </table>
        </div>
      </mat-card-content>
      <b>
        <hr style="margin: 0" />
      </b>
      <mat-card-footer class="pagination-sec">
        <mat-paginator
          [length]="totalPages"
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          (page)="onPageChange($event)"
          showFirstLastButtons
          class="custom-paginator"
        ></mat-paginator>
      </mat-card-footer>
    </mat-card>
  </div>

  <div
    style="
      display: flex;
      direction: row;
      justify-content: flex-end;
      padding: 0px 3%;
      margin-top: 10px;
    "
  >
    <button
      mat-raised-button
      class="button-row"
      color="primary"
      (click)="updateCrmUserId()"
    >
      Update
    </button>
  </div>
</div>
