<div class="pac-header">
  <div class="center">PAYMENTS FOR APPROVAL</div>
  <div class="right">
    <button 
      mat-flat-button
      class="btn-class-home"
      id="goBack"
      style="background-color: rgb(97, 97, 38); color: white; width: 8rem"
      (click)="goBack()"
    >
      Go To Home
    </button>
  </div>
</div>
<div class="filters-div">
  <div class="customer-payment-example-button-row">
    <!-- <mat-form-field class="search-class" appearance="outline">
      <mat-label>Search By Customer</mat-label>
      <input
        matInput
        (input)="onSearchByCustomerName($any($event).target?.value)"
        placeholder="Search By Customer"
      />
    </mat-form-field> -->
    <!-- <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Search/Select Project</mat-label>
      <input
        type="text"
        matInput
        (input)="searchProject($event)"
        [formControl]="project"
        [matAutocomplete]="projectAuto"
      />
      <mat-autocomplete
        #projectAuto="matAutocomplete"
        (optionSelected)="onProjectSelect($event)"
        [displayWith]="displayProject"
      >
        <mat-option *ngFor="let option of projects" [value]="option">
          {{ option.projectName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field> -->

    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Search/Select Block</mat-label>
      <input
        type="text"
        matInput
        (input)="searchBlock($event)"
        [formControl]="block"
        [matAutocomplete]="blockAuto"
      />
      <mat-autocomplete
        #blockAuto="matAutocomplete"
        (optionSelected)="onBlockSelect($event)"
        [displayWith]="displayBlock"
      >
        <mat-option *ngFor="let option of blocks" [value]="option">
          {{ option.name }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Search/Select Unit</mat-label>
      <input
        type="text"
        matInput
        (input)="searchUnit($event)"
        [formControl]="unit"
        [matAutocomplete]="unitAuto"
      />
      <mat-autocomplete
        #unitAuto="matAutocomplete"
        (optionSelected)="onUnitSelect($event)"
        [displayWith]="displayUnit"
      >
        <mat-option *ngFor="let option of units" [value]="option">
          {{ option.unitName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- <mat-form-field appearance="outline" class="search-class-owner ml-2">
      <mat-label>Search Action By</mat-label>
      <input
        matInput
        (input)="onSearchActionBy($any($event).target?.value)"
        placeholder="Search Action By"
      />
    </mat-form-field> -->
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Select Status</mat-label>
      <mat-select
        (selectionChange)="onActionStatusSelect($event)"
        [(ngModel)]="actionStatusId"
      >
        <!-- <mat-option value="All">All</mat-option> -->
        <mat-option
          *ngFor="let element of actionStatusNames"
          [value]="element.id"
        >
          {{ element.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Search By Customer</mat-label>
      <input
        matInput
        (input)="onSearchByCustomerName($any($event).target?.value)"
        placeholder="Search By Customer"
      />
    </mat-form-field>
    <!-- <mat-form-field appearance="outline" class="search-class-status ml-2">
      <mat-label> Payment Status</mat-label>
      <mat-select
        [(value)]="selectedPaymentStatus"
        (selectionChange)="onPaymentStatusSelect($event)"
      >
        <mat-option value="All">All</mat-option>
        <mat-option *ngFor="let element of paymentStatusNames" [value]="element">
          {{ element.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field> -->
    <!-- <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Search Action By</mat-label>
      <input
        matInput
        (input)="onSearchActionBy($any($event).target?.value)"
        placeholder="Search Action By"
      />
    </mat-form-field> -->
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Select TransActionType</mat-label>
      <mat-select
        (selectionChange)="onTransActionTypeSelect($event)"
        [(ngModel)]="transActionTypeId"
      >
        <!-- <mat-option value="All">All</mat-option> -->
        <mat-option
          *ngFor="let element of transActionTypes"
          [value]="element.id"
        >
          {{ element.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Unit Belongs To</mat-label>
      <mat-select
        (selectionChange)="onUnitTypeBelongsChange($event)"
        [(ngModel)]="typeId"
      >
        <mat-option *ngFor="let element of companyType" [value]="element.id">
          {{ element.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Select Date Range</mat-label>
      <mat-date-range-input
        [formGroup]="formData"
        [rangePicker]="picker"
        (click)="picker.open()"
      >
        <input
          matStartDate
          placeholder="Start date"
          formControlName="customStartDate"
          (focus)="picker.open()"
          (dateChange)="onDateChange()"
        />
        <input
          matEndDate
          placeholder="End date"
          formControlName="customEndDate"
          (focus)="picker.open()"
          (dateChange)="onDateChange()"
        />
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
    </mat-form-field>
    <mat-icon
      matTooltip="Clear Date"
      (click)="clearDateRange()"
      class="clear-date-div"
      style="width: 40px; top: 7px; position: relative"
      >sync</mat-icon
    >
  </div>
</div>
<!-- <div class="advanceSearch">
  <mat-checkbox (change)="toggleAdvancedSearch($event.checked)"
    ><i class="bi bi-funnel-fill"></i>Advance Search</mat-checkbox
  >

  <div class="example-button-row">
    <span class="search-container">
      <mat-form-field class="search-class" appearance="outline">
        <mat-label>Search By Customer</mat-label>
        <input
          matInput
          (input)="onSearchByCustomerName($any($event).target?.value)"
          placeholder="Search By Customer"
        />
      </mat-form-field>
    </span>
    <span class="search-container">
      <mat-form-field appearance="outline" class="search-class ml-2">
        <mat-label>Search/Select Stages</mat-label>
        <input
          type="text"
          matInput
          (input)="searchStage($event)"
          [matAutocomplete]="stageAuto"
        />
        <mat-autocomplete
          #stageAuto="matAutocomplete"
          (optionSelected)="onStageSelect($event)"
          [displayWith]="displayStage"
        >
          <mat-option *ngFor="let option of stages" [value]="option">
            {{ option.stageName }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </span>
    <span class="search-container">
      <mat-form-field appearance="outline" class="search-class ml-2">
        <mat-label>Search Action By</mat-label>
        <input
          matInput
          (input)="onSearchActionBy($any($event).target?.value)"
          placeholder="Search Action By"
        />
      </mat-form-field>
    </span>
    <span class="search-container">
      <mat-form-field appearance="outline" class="search-class ml-2">
        <mat-label> Payment Status</mat-label>
        <mat-select
          [(value)]="selectedPaymentStatus"
          (selectionChange)="onPaymentStatusSelect($event)"
        >
          <mat-option value="All">All</mat-option>
          <mat-option
            *ngFor="let element of paymentStatusNames"
            [value]="element"
          >
            {{ element.commonRefValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </span>
  </div>
</div> -->

<mat-card class="cmn-card">
  <mat-card-content class="cmn-card-content">
    <div class="tab-head">
      <table
        matSort
        mat-table
        [dataSource]="paymentDetails"
        class="mat-elevation-z8"
      >
        <ng-container matColumnDef="rowNumber">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let i = index">
            {{ pageIndex * pageSize + i + 1 }}
          </td>
        </ng-container>

        <ng-container matColumnDef="customerName">
          <th mat-header-cell *matHeaderCellDef>Customer Name</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.userName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="createdDate">
          <th mat-header-cell *matHeaderCellDef>Created Date</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.createdDate | date : "dd-MMM-yyyy" }}
          </td>
        </ng-container>

        <!-- <ng-container matColumnDef="stageName">
          <th mat-header-cell *matHeaderCellDef>Stage Name</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.stageName }}
          </td>
        </ng-container> -->

        <ng-container matColumnDef="referenceNumber">
          <th mat-header-cell *matHeaderCellDef>Reference Number</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.referenceNumber }}
          </td>
        </ng-container>

        <ng-container matColumnDef="projectName">
          <th mat-header-cell *matHeaderCellDef>Project</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.projectName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="blockName">
          <th mat-header-cell *matHeaderCellDef>Block</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.blockName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="levelName">
          <th mat-header-cell *matHeaderCellDef>Level</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.levelName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="unitName">
          <th mat-header-cell *matHeaderCellDef>Unit</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.unitName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="paymentDate">
          <th mat-header-cell *matHeaderCellDef>Payment Date</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.paymentDate | date : "dd-MMM-yyyy" }}
          </td>
        </ng-container>

        <ng-container matColumnDef="paidAmount">
          <th mat-header-cell *matHeaderCellDef>Received Amount</th>
          <td
            mat-cell
            *matCellDef="let charge"
            [ngClass]="getStatusClass(charge.actionStatus)"
          >
            {{ charge.formattedPaidAmount }}
          </td>
        </ng-container>
        <!-- <ng-container matColumnDef="paidAmountForApproval">
          <th mat-header-cell *matHeaderCellDef>Paid Amount For Approval</th>
          <td
            mat-cell
            *matCellDef="let charge"
            [ngClass]="{
              pending:
                (charge.formattedPaidAmountForApproval &&
                  charge.formattedPaidAmountForApproval !== '₹0.00' &&
                  charge.formattedPaidAmountForApproval !== '₹0') ||
                (charge.formattedPaidTdsForApproval &&
                  charge.formattedPaidTdsForApproval !== '₹0.00' &&
                  charge.formattedPaidTdsForApproval !== '₹0')
            }"
          >
            {{ charge.formattedPaidAmountForApproval }}
          </td>
        </ng-container> -->

        <ng-container matColumnDef="bankName">
          <th mat-header-cell *matHeaderCellDef>Bank Name</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.bankName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="branchName">
          <th mat-header-cell *matHeaderCellDef>Branch Name</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.branchName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="ifscCode">
          <th mat-header-cell *matHeaderCellDef>IFSC Code</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.ifcCode }}
          </td>
        </ng-container>

        <ng-container matColumnDef="stageStatus">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td
            mat-cell
            *matCellDef="let charge"
            [ngClass]="getStatusClass(charge.actionStatus)"
          >
            {{ charge.actionStatus }}
          </td>
        </ng-container>
        <!-- <ng-container matColumnDef="paymentStatus">
          <th mat-header-cell *matHeaderCellDef>Payment Status</th>
          <td
            mat-cell
            *matCellDef="let charge"
            [ngClass]="getPaymentStatusClass(charge.paymentStatus)"
          >
            {{ charge.paymentStatus }}
          </td>
        </ng-container> -->
        <ng-container matColumnDef="actionDate">
          <th mat-header-cell *matHeaderCellDef>Action Date</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.actionDate | date : "MMM-dd-yyyy" }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actionDoneBy">
          <th mat-header-cell *matHeaderCellDef>Action By</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.actionDoneBy }}
          </td>
        </ng-container>
        <ng-container matColumnDef="transactionType">
          <th mat-header-cell *matHeaderCellDef>Transaction Type</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.transactionType }}
          </td>
        </ng-container>
        <ng-container matColumnDef="companyType">
          <th mat-header-cell *matHeaderCellDef>Unit Belongs To</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.landOwnerOrBuilder }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th
            mat-header-cell
            *matHeaderCellDef
            style="background-color: #004869; color: white"
          >
            Actions
          </th>
          <td mat-cell *matCellDef="let element" class="mat-icon-actions">
            <!-- Approve/Reject Icon -->
            <mat-icon
              matTooltip="Approve/Reject"
              (click)="goToApprovals(element)"
              class="action-icon"
              *ngIf="element.stageStatus === 'Pending'"
            >
              rule
            </mat-icon>

            <!-- Remarks Icon -->
            <mat-icon
              matTooltip="Remarks"
              (click)="ViewRemarks(element)"
              class="action-icon"
              *ngIf="element.stageStatus != 'Pending'"
            >
              visibility
            </mat-icon>
            <mat-menu #menu="matMenu" class="custom-menu">
              <button
                *ngIf="element.emailUrl"
                mat-menu-item
                (click)="downloadDocument('email', element.emailUrl)"
              >
                <mat-icon class="menu-icon">email</mat-icon>
                <span class="menu-label">Download Email</span>
              </button>
              <button
                *ngIf="element.emailUrl"
                mat-menu-item
                (click)="viewDocument('email', element.emailUrl)"
              >
                <mat-icon class="menu-icon"> visibility</mat-icon>
                <span class="menu-label">View email</span>
              </button>

              <button
                mat-menu-item
                *ngIf="element.checkUrl"
                (click)="downloadDocument('check', element.checkUrl)"
              >
                <mat-icon class="menu-icon">file_download</mat-icon>
                <span class="menu-label">Download Slip</span>
              </button>
              <button
                *ngIf="element.checkUrl"
                mat-menu-item
                (click)="viewDocument('check', element.checkUrl)"
              >
                <mat-icon class="menu-icon"> visibility</mat-icon>
                <span class="menu-label">View Slip</span>
              </button>

              <button
                mat-menu-item
                *ngIf="element.challanaUrl"
                (click)="downloadDocument('challan', element.challanaUrl)"
              >
                <mat-icon class="menu-icon">description</mat-icon>
                <span class="menu-label">Download Challan</span>
              </button>
              <button
                *ngIf="element.challanaUrl"
                mat-menu-item
                (click)="viewDocument('challan', element.challanaUrl)"
              >
                <mat-icon class="menu-icon"> visibility</mat-icon>
                <span class="menu-label">View Challan</span>
              </button>
            </mat-menu>
            <mat-icon
              [matMenuTriggerFor]="menu"
              matTooltip="Actions"
              class="action-trigger"
              *ngIf="
                element.emailUrl || element.checkUrl || element.challanaUrl
              "
              >more_vert</mat-icon
            >
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          class="table-row"
          mat-row
          *matRowDef="let charge of paymentDetails; columns: displayedColumns"
        ></tr>
      </table>
    </div>
  </mat-card-content>
  <b>
    <hr style="margin: 0" />
  </b>
  <mat-card-footer class="pagination-sec">
    <mat-paginator
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
      class="custom-paginator"
    ></mat-paginator>
  </mat-card-footer>
</mat-card>

<div *ngIf="isModelView">
  <div
    class="modal fade"
    id="remarksModal"
    tabindex="-1"
    aria-labelledby="remarksModalLabel"
    aria-hidden="true"
    [ngClass]="{ show: isModelView }"
    [style.display]="isModelView ? 'block' : 'none'"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="remarksModalLabel" class="radio-button">
            {{ isRemarksPresent ? "VIEW REMARKS" : "ENTER REMARKS" }}
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            (click)="onClose()"
          ></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <textarea
                class="form-control"
                id="remarks"
                [(ngModel)]="remarks"
                #remarksField="ngModel"
                required
                name="remarks"
                rows="4"
                placeholder="Enter your remarks here"
                (input)="resizeTextarea($event)"
              ></textarea>
              <div
                *ngIf="
                  remarksField.invalid &&
                  (remarksField.dirty || remarksField.touched || isSubmitted)
                "
                class="text-danger mt-1"
              >
                Enter remarks.
              </div>
            </div>
            <!-- <div class="mb-3">
              <div class="choose-file">
                <input
                  type="file"
                  id="fileInput"
                  (change)="onFileChange($event)"
                  #fileInput
                />
              </div>
              <div *ngIf="fileTypeError" class="error-message">
                {{ fileSizeDisplay }}
              </div>
            </div> -->
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
            (click)="onClose()"
          >
            Close
          </button>
          <button
            type="button"
            class="btn btn-danger"
            (click)="handleApprovalStatus('Rejected')"
            *ngIf="!isRemarksPresent"
          >
            Reject
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="handleApprovalStatus('Approval')"
            *ngIf="!isRemarksPresent"
          >
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
