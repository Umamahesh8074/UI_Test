<div class="pac-header">Statement Of Accounts</div>

<div class="example-button-row">
  <div class="search-container">
    <mat-form-field appearance="outline" class="search-class">
      <mat-label>Search On Customer Name</mat-label>
      <input
        matInput
        (input)="onSearch($any($event).target?.value)"
        placeholder="Enter Customer Name"
      />
    </mat-form-field>
    <mat-form-field
      class="search-class"
      appearance="outline"
      *ngIf="!crmMemberRoleName.includes(roleName)"
    >
      <mat-label>Search/Select Project</mat-label>
      <input
        type="text"
        matInput
        (input)="searchProject($event)"
        [formControl]="project"
        [matAutocomplete]="projectAuto"
      />
      <mat-autocomplete
        #projectAuto="matAutocomplete"
        (optionSelected)="onProjectSelect($event)"
        [displayWith]="displayProject"
      >
        <mat-option *ngFor="let option of projects" [value]="option">
          {{ option.projectName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
    <mat-form-field class="search-class ml-2" appearance="outline">
      <mat-label>Search/Select Unit</mat-label>
      <input
        type="text"
        matInput
        (input)="searchUnit($event)"
        [formControl]="unit"
        [matAutocomplete]="unitAuto"
      />
      <mat-autocomplete
        #unitAuto="matAutocomplete"
        (optionSelected)="onUnitSelect($event)"
        [displayWith]="displayUnit"
      >
        <mat-option *ngFor="let option of units" [value]="option">
          {{ option.unitName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
    <mat-form-field appearance="outline" class="search-class ml-2">
      <mat-label>Unit Belongs To</mat-label>
      <mat-select
        (selectionChange)="onUnitTypeBelongsChange($event)"
        [(ngModel)]="typeId"
      >
        <!-- <mat-option value="All">All</mat-option> -->
        <mat-option *ngFor="let element of companyType" [value]="element.id">
          {{ element.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>
<mat-card class="cmn-card">
  <mat-card-content class="cmn-card-content">
    <div class="tab-head">
      <table
        matSort
        mat-table
        [dataSource]="soaDocument"
        class="mat-elevation-z8"
      >
        <ng-container matColumnDef="rowNumber">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let i = index">
            {{ pageIndex * pageSize + i + 1 }}
          </td>
        </ng-container>

        <ng-container matColumnDef="customerName">
          <th mat-header-cell *matHeaderCellDef>Customer Name</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.applicantName }}
          </td>
        </ng-container>
        <ng-container matColumnDef="projectName">
          <th mat-header-cell *matHeaderCellDef>Project Name</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.projectName }}
          </td>
        </ng-container>
        <ng-container matColumnDef="unitName">
          <th mat-header-cell *matHeaderCellDef>unit Name</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.unitName }}
          </td>
        </ng-container>
        <ng-container matColumnDef="companyType">
          <th mat-header-cell *matHeaderCellDef>Company Type</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.landOwnerOrBuilder }}
          </td>
        </ng-container>
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Generated Date</th>
          <td mat-cell *matCellDef="let charge">
            {{ charge.paymentDate | date : "dd-MMM-yyyy" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let charge">
            <mat-icon
              matTooltip="Generate"
              (click)="generateSoaDocument(charge.applicantId,charge.projectName)"
              class="action-icon"
              >manage_history</mat-icon
            >
            <mat-icon
              matTooltip="View Downloads"
              (click)="getDocumentsBasedOnId(charge.applicantId)"
              class="font action-icon"
              >insert_drive_file</mat-icon
            >
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          class="table-row"
          mat-row
          *matRowDef="let charge of paymentDetails; columns: displayedColumns"
        ></tr>
      </table>
    </div>
  </mat-card-content>
  <b>
    <hr style="margin: 0" />
  </b>
  <mat-card-footer class="pagination-sec">
    <mat-paginator
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
      class="custom-paginator"
    ></mat-paginator>
  </mat-card-footer>
</mat-card>

<div
  *ngIf="openDialog"
  class="modal fade show"
  tabindex="-1"
  style="display: block"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="radio-button">DOWNLOAD DOCUMENTS</h3>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          (click)="onClose()"
        ></button>
      </div>
      <div class="modal-body1">
        <!-- Check if documents array is empty -->
        <div *ngIf="!documents || documents.length === 0; else documentsTable">
          <p>No documents available.</p>
        </div>

        <!-- Template for displaying the documents -->
        <ng-template #documentsTable>
          <table
            matSort
            mat-table
            [dataSource]="documents"
            class="mat-elevation-z8"
          >
            <ng-container matColumnDef="fileName">
              <th mat-header-cell *matHeaderCellDef>File Name</th>
              <td mat-cell *matCellDef="let document">
                {{ document.documentName }}
              </td>
            </ng-container>

            <ng-container matColumnDef="createdDate">
              <th mat-header-cell *matHeaderCellDef>Created Date</th>
              <td mat-cell *matCellDef="let document">
                {{ document.createdDate | date : "medium" }}
              </td>
            </ng-container>
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let document">
                <mat-icon
                  matTooltip="Download"
                  (click)="downloadDocument(document)"
                  class="action-icon"
                  >download</mat-icon
                >
                <mat-icon
                  matTooltip="View Receipt"
                  (click)="viewDocument(document)"
                  class="view-icon"
                >
                  visibility
                </mat-icon>
              </td>
            </ng-container>
            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumnsDocuments"
            ></tr>
            <tr
              class="table-row"
              mat-row
              *matRowDef="let row; columns: displayedColumnsDocuments"
            ></tr>
          </table>
        </ng-template>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="onClose()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
