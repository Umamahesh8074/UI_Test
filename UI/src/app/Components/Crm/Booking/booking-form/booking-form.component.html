<div class="stepper-header">
  <button
    mat-flat-button
    class="btn-class accent"
    (click)="gotoBookingOverview()"
    type="button"
  >
    <mat-icon class="back-icon">arrow_back</mat-icon>
    Booking Overview
  </button>

  <h4 class="header">
    <b>{{ isAdding ? "ADD BOOKING" : "EDIT BOOKING" }}</b>
  </h4>
</div>
<mat-vertical-stepper [linear]="isAdding" #stepper>
  <mat-step [stepControl]="unitForm" label="Unit Details">
    <form [formGroup]="unitForm" (ngSubmit)="save()">
      <div class="example-container">
        <mat-form-field
          class="example-full-width"
          class="mat-45"
          appearance="outline"
        >
          <mat-label>Search/Select Project</mat-label>
          <input
            type="text"
            matInput
            [value]="
              selectedProject.projectName ? selectedProject.projectName : ''
            "
            (input)="searchProject($event)"
            [formControl]="projectFc"
            [matAutocomplete]="projectAuto"
            [readonly]="!isAdding"
            [ngClass]="{ 'read-only-input': !isAdding }"
          />
          <mat-autocomplete
            #projectAuto="matAutocomplete"
            (optionSelected)="onProjectSelect($event)"
            [displayWith]="displayProject"
          >
            <mat-option *ngFor="let option of projectsData" [value]="option">
              {{ option.projectName }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field
          class="example-full-width"
          class="mat-45"
          appearance="outline"
        >
          <mat-label>Search/Select Unit</mat-label>
          <input
            type="text"
            matInput
            [value]="selectedUnit.unitName ? selectedUnit.unitName : ''"
            (input)="searchUnit($event)"
            [formControl]="unitFc"
            [matAutocomplete]="unitAuto"
            [readonly]="!isAdding"
            [ngClass]="{ 'read-only-input': !isAdding }"
          />
          <mat-autocomplete
            #unitAuto="matAutocomplete"
            (optionSelected)="onUnitSelect($event)"
            [displayWith]="displayUnit"
          >
            <mat-option *ngFor="let option of availableUnits" [value]="option">
              {{ option.unitName }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field class="example-full-width mat-45" appearance="outline">
          <mat-label>Search by Primary Applicant Phone Number</mat-label>
          <input
            matInput
            formControlName="firstApplicantPhoneNumber"
            (input)="onSearchPhoneNumber($any($event).target?.value)"
            placeholder="Enter Phone Number"
            [readonly]="!isAdding"
            [ngClass]="{ 'read-only-input': !isAdding }"
          />
        </mat-form-field>

        <mat-form-field
          class="example-full-width"
          class="mat-45"
          appearance="outline"
        >
          <mat-label>Search by Co-Applicant Phone Number</mat-label>
          <input
            matInput
            formControlName="secondApplicantPhoneNumber"
            (input)="onSearchCoApplicantPhoneNumber($any($event).target.value)"
            placeholder="Enter Co-Applicant Phone Number"
            [readonly]="!isAdding"
            [ngClass]="{ 'read-only-input': !isAdding }"
          />
        </mat-form-field>
      </div>
      <div *ngIf="showDetails" class="example-container">
        <h4 class="booking-header">Flat Details</h4>
        <!-- <div class="boundary-header">
          <mat-label class="boundary-label"></mat-label>
        </div> -->
        <mat-card class="card" style="margin-bottom: 0px; padding: 0px">
          <!-- <div class="booking-container">
            <h4 class="booking-header">Flat Details</h4>
          </div> -->

          <mat-card-content class="cpr-mat-card-content scrollable-content">
            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Block Name</mat-label>
              <input
                matInput
                [value]="selectedBlockName"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Level Name</mat-label>
              <input
                matInput
                [value]="selectedLevelName"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Unit Type Name</mat-label>
              <input
                matInput
                formControlName="unitTypeName"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Phase</mat-label>
              <input
                matInput
                formControlName="phase"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Super Area</mat-label>
              <input
                matInput
                formControlName="superArea"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Balcony Area</mat-label>
              <input
                matInput
                formControlName="balconyArea"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Carpet Area</mat-label>
              <input
                matInput
                formControlName="carpetArea"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Uds Area</mat-label>
              <input
                matInput
                formControlName="udsArea"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field appearance="outline" class="cpr-mat-25">
              <mat-label>Base Rate (Per Sq. Ft.)</mat-label>
              <input
                matInput
                formControlName="basicPrice"
                [readonly]="!isAdding"
                (input)="formatInputValue('basicPrice', $event)"
              />
              <mat-error
                *ngIf="unitForm.get('basicPrice')?.hasError('required')"
              >
                Base Rate is required.
              </mat-error>
              <mat-error *ngIf="unitForm.get('basicPrice')?.hasError('min')">
                Base Rate must be greater than 0.
              </mat-error>
            </mat-form-field>

            <!-- <mat-form-field appearance="outline" class="cpr-mat-25">
              <mat-label>Base Price</mat-label>
              <input
                matInput
                formControlName="basePrice"
                [readonly]="!isAdding"
                (input)="formatInputValue('basePrice', $event)"
              />
              <mat-error
                *ngIf="unitForm.get('basePrice')?.hasError('required')"
              >
                Base Price is required.
              </mat-error>
              <mat-error *ngIf="unitForm.get('basePrice')?.hasError('min')">
                Base Price must be greater than 0.
              </mat-error>
            </mat-form-field> -->

            <mat-form-field appearance="outline" class="cpr-mat-25">
              <mat-label>Total Unit Cost Including GST</mat-label>
              <input
                matInput
                formControlName="finalPrice"
                [readonly]="!isAdding"
                (input)="formatInputValue('finalPrice', $event)"
              />
              <mat-error
                *ngIf="unitForm.get('finalPrice')?.hasError('required')"
              >
                Final Price is required.
              </mat-error>
              <mat-error *ngIf="unitForm.get('finalPrice')?.hasError('min')">
                Final Price must be greater than 0.
              </mat-error>
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Select Payment Plan</mat-label>
              <mat-select formControlName="paymentPlanId">
                <mat-option
                  *ngFor="let paymentPlan of paymentPlans"
                  [value]="paymentPlan.id"
                  >{{ paymentPlan.planName }}</mat-option
                >
              </mat-select>
              <mat-error
                *ngIf="
                  personalInfoForm.get('paymentPlanId')?.hasError('required')
                "
              >
                Payment Plan is required.
              </mat-error>
            </mat-form-field>
            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Date Of Booking</mat-label>
              <input
                matInput
                [matDatepicker]="bookingDatePicker"
                (click)="bookingDatePicker.open()"
                formControlName="bookingDate"
                placeholder="Select Your Date Of Birth"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="bookingDatePicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #bookingDatePicker></mat-datepicker>

              <mat-error
                *ngIf="unitForm.get('bookingDate')?.hasError('required')"
              >
                Date of Booking is required.
              </mat-error>
              <mat-error
                *ngIf="unitForm.get('bookingDate')?.hasError('futureDate')"
              >
                Date of Booking cannot be in the future.
              </mat-error>
            </mat-form-field>
            <!-- <mat-form-field class="cpr-mat-30" appearance="outline">
              <mat-label>Booked By</mat-label>
              <mat-select formControlName="bookedById">
                <mat-option
                  *ngFor="let salesTeamMembers of salesTeamMembers"
                  [value]="salesTeamMembers.salesId"
                  >{{ salesTeamMembers.salesName }}</mat-option
                >
              </mat-select>
              <mat-error
                *ngIf="personalInfoForm.get('bookedById')?.hasError('required')"
              >
                Booking agent is required.
              </mat-error>
            </mat-form-field> -->
          </mat-card-content>
        </mat-card>
        <h4 class="booking-header" id="unit-headers">Boundaries</h4>
        <mat-card class="card" style="margin-bottom: 0px; padding: 0px">
          <!-- <div class="boundary-header">
            <mat-label class="boundary-label">Boundaries</mat-label>
          </div> -->

          <mat-card-content class="cpr-mat-card-content scrollable-content">
            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>East</mat-label>
              <input
                matInput
                formControlName="east"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>West</mat-label>
              <input
                matInput
                formControlName="west"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>North</mat-label>
              <input
                matInput
                formControlName="north"
                readonly
                class="read-only-input"
              />
            </mat-form-field>

            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>South</mat-label>
              <input
                matInput
                formControlName="south"
                readonly
                class="read-only-input"
              />
            </mat-form-field>
          </mat-card-content>
        </mat-card>
        <h4 class="booking-header" id="unit-headers">Lead Details</h4>
        <mat-card class="card" style="margin-bottom: 0px; padding: 0px">
          <!-- <div class="boundary-header">
            <mat-label class="boundary-label">Lead Details</mat-label>
          </div> -->

          <mat-card-content class="cpr-mat-card-content scrollable-content">
            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Source Name</mat-label>
              <input
                matInput
                formControlName="sourceName"
                readonly
                class="read-only-input"
              />
            </mat-form-field>
            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Sub Source Name</mat-label>
              <input
                matInput
                formControlName="subSourceName"
                readonly
                class="read-only-input"
              />
            </mat-form-field>
            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Sales Name</mat-label>
              <input
                matInput
                [value]="salesName"
                readonly
                class="read-only-input"
              />
            </mat-form-field>
            <mat-form-field class="cpr-mat-25" appearance="outline">
              <mat-label>Pre Sales Name</mat-label>
              <input
                matInput
                [value]="preSalesName || 'NA'"
                readonly
                class="read-only-input"
              />
            </mat-form-field>
          </mat-card-content>
        </mat-card>

        <!-- <div id="crm-user">
          <mat-label id="crm-user">CRM USER : </mat-label>
          <mat-form-field
            class="example-full-width"
            class="mat-45"
            appearance="outline"
          >
            <mat-label>Search/Select User</mat-label>
            <input
              type="text"
              matInput
              [value]="selectedUser.userName ? selectedUser.userName : ''"
              (input)="searchUser($event)"
              [formControl]="userFc"
              [matAutocomplete]="userAuto"
            />
            <mat-autocomplete
              #userAuto="matAutocomplete"
              (optionSelected)="onUserSelect($event)"
              [displayWith]="displayUser"
            >
              <mat-option *ngFor="let option of userData" [value]="option">
                {{ option.userName }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
        </div> -->
      </div>

      <div>
        <!-- <button mat-button matStepperNext type="button" [disabled]="unitForm.invalid">Next </button> -->
        <!-- <button
          *ngIf="isAdding"
          mat-flat-button
          class="btn-class warn"
          (click)="clearForm()"
          type="button"
        >
          RESET
        </button> -->
        <!-- <button
              mat-flat-button
              class="btn-class accent"
               matStepperPrevious
              type="button"
            >
              BACK
            </button> -->
        <button
          id="unit-button"
          mat-flat-button
          class="btn-class primary"
          type="submit"
          *ngIf="showDetails"
          (click)="handleNextClick()"
          matStepperNext
        >
          SAVE & NEXT
        </button>
      </div>

      <div>
        <!-- <button mat-button matStepperPrevious type="button">Back</button> -->
      </div>
    </form>
  </mat-step>
  <!-- <mat-step [stepControl]="projectInfoForm" label="Charges Details">
    <save-booking-charge
      [bookingId]="unitForm.get('bookingId')?.value"
      [finalPrice]="unitForm.get('finalPrice')?.value"
      [basePrice]="unitForm.get('basePrice')?.value"
      [totalCharges]="unitForm.get('totalCharges')?.value"
      [organizationId]="organizationId"
      [projectId]="unitForm.get('projectId')?.value"
      [levelId]="unitForm.get('levelId')?.value"
      [superBuildUpArea]="
        sanitizeSuperBuildUpArea(unitForm.get('superArea')?.value)
      "
    >
    </save-booking-charge>
    <mat-card-footer class="">
      <div id="project-charges">
        <button
          mat-flat-button
          class="btn-class accent"
          matStepperPrevious
          type="button"
        >
          BACK
        </button>
        <button
          mat-flat-button
          class="btn-class primary"
          matStepperNext
          type="button"
          (click)="handleNextClick()"
        >
          SAVE & NEXT
        </button>
      </div>
    </mat-card-footer>
  </mat-step> -->

  <mat-step [stepControl]="personalInfoForm" label="Applicant Details" #stepper>
    <form [formGroup]="personalInfoForm" (ngSubmit)="onSubmit(stepper)">
      <!-- <span class="search-container">
        <mat-form-field appearance="outline" class="serach-class">
          <mat-label>Search On Phone Number</mat-label>
          <input
            matInput
            formControlName="firstApplicantPhoneNumber"
            (input)="onSearchPhoneNumber($any($event).target?.value)"
            placeholder="Enter Phone Number"
          />
        </mat-form-field>
      </span> -->
      <div class="form-container">
        <h4 class="booking-header">Enter Applicant Details</h4>
        <mat-card class="card" style="padding: 0px; margin-bottom: 0px">
          <mat-card-content class="form-card-content">
            <div class="form-row" style="padding-top: 10px">
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Salutation</mat-label>
                <mat-select formControlName="firstApplicantSalutation">
                  <!-- <mat-option value=""></mat-option> -->
                  <mat-option
                    *ngFor="let element of salutations"
                    [value]="element.commonRefKey"
                  >
                    {{ element.commonRefValue }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantSalutation')
                      ?.hasError('required')
                  "
                >
                  Please select a salutation.
                </mat-error>
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Customer Name</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantName"
                  type="text"
                />
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantName')
                      ?.hasError('required')
                  "
                >
                  Customer Name is required
                </mat-error>
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Date Of Birth</mat-label>
                <input
                  matInput
                  [matDatepicker]="firstApplicantPicker"
                  (click)="firstApplicantPicker.open()"
                  formControlName="firstApplicantDateOfBirth"
                  placeholder="Select Your Date Of Birth"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="firstApplicantPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #firstApplicantPicker></mat-datepicker>

                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantDateOfBirth')
                      ?.hasError('required')
                  "
                >
                  Date of Birth is required.
                </mat-error>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantDateOfBirth')
                      ?.hasError('futureDate')
                  "
                >
                  Date of Birth cannot be in the future.
                </mat-error>
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Gender</mat-label>
                <mat-select formControlName="firstApplicantGender">
                  <!-- <mat-option value=""></mat-option> -->
                  <mat-option
                    *ngFor="let element of gender"
                    [value]="element.commonRefKey"
                  >
                    {{ element.commonRefValue }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <!-- <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Middle Name</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantMiddleName"
                  type="text"
                /> -->
              <!-- <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantMiddleName')
                      ?.hasError('required')
                  "
                >
                  Middle Name is required
                </mat-error> -->
              <!-- </mat-form-field> -->

              <!-- <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Last Name</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantLastName"
                  type="text"
                />
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantLastName')
                      ?.hasError('required')
                  "
                >
                  Last Name is required
                </mat-error>
              </mat-form-field> -->
            </div>

            <div class="form-row">
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Nationality</mat-label>
                <mat-select formControlName="firstApplicantNationality">
                  <!-- <mat-option value=""></mat-option> -->
                  <mat-option
                    *ngFor="let element of nationality"
                    [value]="element.commonRefKey"
                  >
                    {{ element.commonRefValue }}
                  </mat-option>
                </mat-select>
                <!-- <mat-error *ngIf="formData.get('firstApplicantSalutation')?.hasError('required')">
                  Please select one option
                </mat-error> -->
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Relation To Parent/Spouse</mat-label>
                <mat-select formControlName="firstApplicantRelationToParent">
                  <!-- <mat-option value="">Select Salutation</mat-option> -->
                  <mat-option
                    *ngFor="let element of relationToGuardian"
                    [value]="element.commonRefKey"
                  >
                    {{ element.commonRefValue }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantRelationToParent')
                      ?.hasError('required')
                  "
                >
                  Please select a relation to Parent/Spouse.
                </mat-error>
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Salutation</mat-label>
                <mat-select
                  formControlName="firstApplicantParentOrSpouseSalutation"
                >
                  <!-- <mat-option value="">Select Salutation</mat-option> -->
                  <mat-option
                    *ngFor="let element of salutations"
                    [value]="element.commonRefKey"
                  >
                    {{ element.commonRefValue }}
                  </mat-option>
                </mat-select>
                <mat-error
                  *ngIf="
                    personalInfoForm.get(
                      'firstApplicantParentOrSpouseSalutation'
                    )?.touched &&
                    personalInfoForm
                      .get('firstApplicantParentOrSpouseSalutation')
                      ?.hasError('required')
                  "
                >
                  Please select a salutation.
                </mat-error>
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Parent/Spouse Name</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantParentOrSpouse"
                  type="text"
                />

                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantParentOrSpouse')
                      ?.hasError('required')
                  "
                >
                  Parent/Spouse Name is required.
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Marital Status</mat-label>
                <mat-select formControlName="firstApplicantMaritalStatus">
                  <!-- <mat-option value="">Select Salutation</mat-option> -->
                  <mat-option
                    *ngFor="let element of maritalStatus"
                    [value]="element.commonRefKey"
                  >
                    {{ element.commonRefValue }}
                  </mat-option>
                </mat-select>
                <!-- <mat-error *ngIf="formData.get('firstApplicantSalutation')?.hasError('required')">
                  Please select one option
                </mat-error> -->
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Anniversary Date</mat-label>
                <input
                  matInput
                  [matDatepicker]="firstAnniversaryDatePicker"
                  (click)="firstAnniversaryDatePicker.open()"
                  formControlName="firstApplicantAnniversaryDate"
                  placeholder="Select Your Anniversary Date"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="firstAnniversaryDatePicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #firstAnniversaryDatePicker></mat-datepicker>
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Passport Number</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantPassportNumber"
                  type="text"
                />
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Email ID</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantEmail"
                  type="email"
                  required
                />
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantEmail')
                      ?.hasError('required')
                  "
                >
                  Email ID is required
                </mat-error>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantEmail')
                      ?.hasError('email')
                  "
                >
                  Please enter a valid email address
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-row">
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Alternate Email ID</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantAlternateEmail"
                  type="email"
                />
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Phone Number</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantPhoneNumber"
                  type="text"
                />
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Alternate Phone Number</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantAlternatePhoneNumber"
                  type="text"
                  pattern="^\d{10}$"
                />
                <!-- <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantAlternatePhoneNumber')
                      ?.hasError('required')
                  "
                >
                  Alternate Phone Number is required
                </mat-error>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantAlternatePhoneNumber')
                      ?.hasError('pattern')
                  "
                >
                  Please enter a valid 10-digit phone number
                </mat-error> -->
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Guardian Name(If Minor)</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantGuardianName"
                  type="text"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Aadhar Number</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantAadharNumber"
                  type="text"
                  required
                />
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantAadharNumber')
                      ?.hasError('required')
                  "
                >
                  Aadhar Number is required
                </mat-error>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantAadharNumber')
                      ?.hasError('pattern')
                  "
                >
                  Aadhar Number must be a 12-digit number
                </mat-error>
              </mat-form-field>

              <mat-form-field
                class="cpr-mat-25"
                appearance="outline"
                [ngClass]="{
                  'error-border':
                    personalInfoForm.get('firstApplicantAadharCard')?.invalid &&
                    personalInfoForm.get('firstApplicantAadharCard')?.touched &&
                    !personalInfoForm.get('firstApplicantAadharCard')?.value
                }"
              >
                <mat-label>Aadhar Card</mat-label>

                <!-- Readonly text field to show selected file name -->
                <input
                  matInput
                  formControlName="firstApplicantAadharCard"
                  [attr.placeholder]="'Choose File'"
                  type="text"
                  readonly
                  (click)="firstApplicantAadharCard.click()"
                  [value]="fileNames.firstApplicantAadharCard"
                />

                <!-- Hidden file input -->
                <input
                  type="file"
                  #firstApplicantAadharCard
                  (change)="
                    onCheckFileChange($event, 'firstApplicantAadharCard')
                  "
                  style="display: none"
                />

                <!-- Attach file button -->
                <button
                  mat-icon-button
                  matSuffix
                  (click)="firstApplicantAadharCard.click()"
                  type="button"
                >
                  <mat-icon>attach_file</mat-icon>
                </button>

                <!-- Show error only if field is empty -->
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantAadharCard')
                      ?.hasError('required') &&
                    !personalInfoForm.get('firstApplicantAadharCard')?.value
                  "
                >
                  Please upload your Aadhar Card.
                </mat-error>
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Pan Number</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantPanNumber"
                  (input)="onPanNumberInput('firstApplicantPanNumber')"
                />
                <mat-error
                  *ngIf="
                    isAdding &&
                    personalInfoForm
                      .get('firstApplicantPanNumber')
                      ?.hasError('required')
                  "
                >
                  PAN Number is required
                </mat-error>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantPanNumber')
                      ?.hasError('pattern')
                  "
                >
                  PAN Number must be in the format ABCDE1234F
                </mat-error>
              </mat-form-field>

              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Pan Card</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantPanCard"
                  [attr.placeholder]="'Choose File'"
                  [attr.type]="'text'"
                  [attr.readonly]="true"
                  (click)="firstApplicantPanCard.click()"
                  [value]="fileNames.firstApplicantPanCard"
                />
                <input
                  type="file"
                  #firstApplicantPanCard
                  (change)="onCheckFileChange($event, 'firstApplicantPanCard')"
                  style="display: none"
                />
                <button
                  mat-icon-button
                  matSuffix
                  (click)="firstApplicantPanCard.click()"
                  type="button"
                >
                  <mat-icon>attach_file</mat-icon>
                </button>
                <mat-error
                  *ngIf="
                    personalInfoForm.get('firstApplicantPanCard')?.touched &&
                    personalInfoForm
                      .get('firstApplicantPanCard')
                      ?.hasError('required')
                  "
                >
                  Please upload your Pan Card.
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-row">
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Profession</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantProfession"
                  type="text"
                />
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Designation</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantDesignation"
                  type="text"
                />
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Employed At</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantEmployedAt"
                  type="text"
                />
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Industry</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantIndustry"
                  type="text"
                />
              </mat-form-field>
            </div>
          </mat-card-content>
        </mat-card>
        <h4 class="booking-header">Address Details</h4>
        <mat-card class="card" style="padding: 0px; margin-bottom: 0px">
          <mat-card-content class="cpr-mat-card-content scrollable-content">
            <div class="form-row" style="padding-top: 10px">
              <mat-form-field class="cpr-mat-30" appearance="outline">
                <mat-label>Pin Code</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantPincode"
                  (input)="onSearchPinCode(pincode.value, 'first')"
                  #pincode
                  type="text"
                />

                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantPincode')
                      ?.hasError('required')
                  "
                >
                  Pin Code is required.
                </mat-error>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantPincode')
                      ?.hasError('pattern')
                  "
                >
                  Pin Code must be a 6-digit number.
                </mat-error>
              </mat-form-field>
              <!-- <mat-form-field class="cpr-mat-30" appearance="outline">
                <mat-label>Address Line 1</mat-label>
                <input matInput formControlName="firstApplicantAddress1" type="text" />
                <mat-error *ngIf="
                    personalInfoForm
                      .get('firstApplicantAddress1')
                      ?.hasError('required')
                  ">
                  Address is required.
                </mat-error>
              </mat-form-field> -->

              <div appearance="outline" class="cpr-mat-30">
                <textarea
                  id="al-otr-rsn"
                  matInput
                  formControlName="firstApplicantAddress1"
                  rows="1"
                  placeholder="Address Line 1"
                  style="
                    flex: 1;
                    width: 100%;
                    padding: 5px 10px;
                    font-size: 13px;
                  "
                  (input)="autoResize()"
                  #textArea
                ></textarea>
                <mat-error
                  *ngIf="
                    personalInfoForm.get('firstApplicantAddress1')?.invalid &&
                    personalInfoForm.get('firstApplicantAddress1')?.touched
                  "
                >
                  Address Line 1 is required.
                </mat-error>
              </div>

              <div appearance="outline" class="cpr-mat-30">
                <textarea
                  id="al-otr-rsn"
                  matInput
                  formControlName="firstApplicantAddress2"
                  rows="1"
                  placeholder="Address Line 2"
                  style="
                    flex: 1;
                    width: 100%;
                    padding: 5px 10px;
                    font-size: 13px;
                  "
                  (input)="autoResize()"
                  #textArea
                ></textarea>
                <!-- <mat-error *ngIf="personalInfoForm.get('firstApplicantAddress1')?.hasError('required')">
                  Address is required.
                </mat-error> -->
              </div>

              <!-- <mat-form-field appearance="outline" class="cpr-mat-30">
                <mat-label>Address Line2</mat-label>
                <mat-select formControlName="firstApplicantAddress2"> -->
              <!-- <mat-option *ngFor="let city of filteredData['first']?.addresses" [value]="city">
                    {{ city }}
                  </mat-option> -->
              <!-- </mat-select>
              </mat-form-field> -->

              <!-- <mat-form-field class="cpr-mat-50" appearance="outline">
                <mat-label>Addess Line2</mat-label>


                <mat-select formControlName="firstApplicantAddress2">
                  <mat-option *ngFor="let city of filteredAddresses" [value]="city">
                    {{ city }}
                  </mat-option>
                </mat-select>
              </mat-form-field>-->
            </div>
            <div class="form-row">
              <!-- <mat-form-field appearance="outline" class="cpr-mat-50">
                <mat-label>Address Line2</mat-label>
                <input type="text" matInput 
                       [value]="selectedAddress" 
                       (input)="searchAddress($event)" 
                       [formControl]="addressControl" 
                       [matAutocomplete]="addressAuto" />
                <mat-autocomplete #addressAuto="matAutocomplete" 
                                  (optionSelected)="onAddressSelect($event)" 
                                  [displayWith]="displayAddress">
                  <mat-option *ngFor="let city of filteredData['first']?.addresses" [value]="city">
                    {{ city }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field> -->

              <mat-form-field appearance="outline" class="cpr-mat-30">
                <mat-label>City</mat-label>
                <mat-select formControlName="firstApplicantCity">
                  <mat-option
                    *ngFor="let district of filteredData['first']?.cities"
                    [value]="district"
                  >
                    {{ district }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="cpr-mat-30">
                <mat-label>State</mat-label>
                <mat-select formControlName="firstApplicantState">
                  <mat-option
                    *ngFor="let state of filteredData['first']?.states"
                    [value]="state"
                  >
                    {{ state }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- <mat-form-field class="cpr-mat-30" appearance="outline">
                <mat-label>City</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantCity"
                  type="text"
                />
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantCity')
                      ?.hasError('required')
                  "
                >
                  City is required.
                </mat-error>
              </mat-form-field> -->
              <!-- <mat-form-field class="cpr-mat-30" appearance="outline">
                <mat-label>Pin Code</mat-label>
                <input
                  matInput
                  formControlName="firstApplicantPincode"
                  (input)="onSearchPinCode(pincode.value)"
                  #pincode
                  type="text"
                />
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantPincode')
                      ?.hasError('required')
                  "
                >
                  Pin Code is required.
                </mat-error>
                <mat-error
                  *ngIf="
                    personalInfoForm
                      .get('firstApplicantPincode')
                      ?.hasError('pattern')
                  "
                >
                  Pin Code must be a 6-digit number.
                </mat-error>
              </mat-form-field> -->
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      <div>
        <!-- <mat-checkbox
          [checked]="isCoApplicantChecked"
          (change)="onCheckboxChange($event)"
          style="margin-left: 14px; margin-bottom: 30px"
        >
          Add Co-Applicant1 Details
        </mat-checkbox> -->

        <div class="co-applicant-section">
          <h4
            class="booking-header"
            style="margin-left: 20px; margin-right: 50px"
          >
            Co Applicant1 Details
          </h4>
          <mat-card class="card" style="margin-bottom: 0px">
            <mat-card-content class="form-card-content">
              <div class="form-row" style="padding-top: 10px">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Salutation</mat-label>
                  <mat-select formControlName="secondApplicantSalutation">
                    <!-- <mat-option value="">Select Salutation</mat-option> -->
                    <mat-option
                      *ngFor="let element of salutations"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantSalutation')
                        ?.hasError('required')
                    "
                  >
                    Please select a salutation.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Customer Name</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantName"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantName')
                        ?.hasError('required')
                    "
                  >
                    Customer Name is required
                  </mat-error>
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Date Of Birth</mat-label>
                  <input
                    matInput
                    [matDatepicker]="secondApplicantPicker"
                    (click)="secondApplicantPicker.open()"
                    formControlName="secondApplicantDateOfBirth"
                    placeholder="Select Your Date Of Birth"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="secondApplicantPicker"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #secondApplicantPicker></mat-datepicker>

                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantDateOfBirth')
                        ?.hasError('required')
                    "
                  >
                    Date of Birth is required.
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantDateOfBirth')
                        ?.hasError('futureDate')
                    "
                  >
                    Date of Birth cannot be in the future.
                  </mat-error>
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Gender</mat-label>
                  <mat-select formControlName="secondApplicantGender">
                    <!-- <mat-option value=""></mat-option> -->
                    <mat-option
                      *ngFor="let element of gender"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <!-- <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Middle Name</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantMiddleName"
                    type="text"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Last Name</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantLastName"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantLastName')
                        ?.hasError('required')
                    "
                  >
                    Last Name is required
                  </mat-error>
                </mat-form-field> -->
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Nationality</mat-label>
                  <mat-select formControlName="secondApplicantNationality">
                    <!-- <mat-option value=""></mat-option> -->
                    <mat-option
                      *ngFor="let element of nationality"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <!-- <mat-error *ngIf="formData.get('firstApplicantSalutation')?.hasError('required')">
                    Please select one option
                  </mat-error> -->
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Relation To Parent/Spouse</mat-label>
                  <mat-select formControlName="secondApplicantRelationToParent">
                    <mat-option
                      *ngFor="let element of relationToGuardian"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantRelationToParent')
                        ?.hasError('required')
                    "
                  >
                    Please select a relation to Parent/Spouse.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Salutation</mat-label>
                  <mat-select
                    formControlName="secondApplicantParentOrSpouseSalutation"
                  >
                    <!-- <mat-option value="">Select Salutation</mat-option> -->
                    <mat-option
                      *ngFor="let element of salutations"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      personalInfoForm.get(
                        'secondApplicantParentOrSpouseSalutation'
                      )?.touched &&
                      personalInfoForm
                        .get('secondApplicantParentOrSpouseSalutation')
                        ?.hasError('required')
                    "
                  >
                    Please select a salutation.
                  </mat-error>
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Parent/Spouse Name</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantParentOrSpouse"
                    type="text"
                  />
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Marital Status</mat-label>
                  <mat-select formControlName="secondApplicantMaritalStatus">
                    <!-- <mat-option value="">Select Salutation</mat-option> -->
                    <mat-option
                      *ngFor="let element of maritalStatus"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <!-- <mat-error *ngIf="formData.get('firstApplicantSalutation')?.hasError('required')">
                    Please select one option
                  </mat-error> -->
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Anniversary Date</mat-label>
                  <input
                    matInput
                    [matDatepicker]="secondApplicantAnniversaryPicker"
                    (click)="secondApplicantAnniversaryPicker.open()"
                    formControlName="secondApplicantAnniversaryDate"
                    placeholder="Select Your Anniversary Date"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="secondApplicantAnniversaryPicker"
                  ></mat-datepicker-toggle>
                  <mat-datepicker
                    #secondApplicantAnniversaryPicker
                  ></mat-datepicker>
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Passport Number</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantPassportNumber"
                    type="text"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Email ID</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantEmail"
                    type="email"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantEmail')
                        ?.hasError('required')
                    "
                  >
                    Email ID is required
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantEmail')
                        ?.hasError('email')
                    "
                  >
                    Please enter a valid email address
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Alternate Email ID</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantAlternateEmail"
                    type="email"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Phone Number</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantPhoneNumber"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm.get('secondApplicantPhoneNumber')
                        ?.invalid &&
                      personalInfoForm.get('secondApplicantPhoneNumber')
                        ?.touched
                    "
                  >
                    Phone number must be exactly 10 digits.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Alternate Phone Number</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantAlternatePhoneNumber"
                    type="text"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Guardian Name(If Minor)</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantGuardianName"
                    type="text"
                  />
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Aadhar Number</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantAadharNumber"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantAadharNumber')
                        ?.hasError('required')
                    "
                  >
                    Aadhar Number is required
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantAadharNumber')
                        ?.hasError('pattern')
                    "
                  >
                    Aadhar Number must be a 12-digit number
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Aadhar Card</mat-label>
                  <input
                    matInput
                    placeholder="Choose File"
                    type="text"
                    readonly
                    (click)="secondApplicantAadharCard.click()"
                    [value]="fileNames.secondApplicantAadharCard || ''"
                    formControlName="secondApplicantAadharCard"
                  />
                  <input
                    type="file"
                    #secondApplicantAadharCard
                    (change)="
                      onCheckFileChange($event, 'secondApplicantAadharCard')
                    "
                    style="display: none"
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    (click)="secondApplicantAadharCard.click()"
                    type="button"
                  >
                    <mat-icon>attach_file</mat-icon>
                  </button>
                  <mat-error
                    *ngIf="
                      personalInfoForm.get('secondApplicantAadharCard')
                        ?.touched &&
                      personalInfoForm
                        .get('secondApplicantAadharCard')
                        ?.hasError('required')
                    "
                  >
                    Please upload your Aadhar Card.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Pan Number</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantPanNumber"
                    (input)="onPanNumberInput('secondApplicantPanNumber')"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantPanNumber')
                        ?.hasError('required')
                    "
                  >
                    PAN Number is required
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantPanNumber')
                        ?.hasError('pattern')
                    "
                  >
                    PAN Number must be in the format ABCDE1234F
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Pan Card</mat-label>
                  <input
                    matInput
                    placeholder="Choose File"
                    type="text"
                    readonly
                    (click)="secondApplicantPanCard.click()"
                    [value]="fileNames.secondApplicantPanCard || ''"
                    formControlName="secondApplicantPanCard"
                  />
                  <input
                    type="file"
                    #secondApplicantPanCard
                    (change)="
                      onCheckFileChange($event, 'secondApplicantPanCard')
                    "
                    style="display: none"
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    (click)="secondApplicantPanCard.click()"
                    type="button"
                  >
                    <mat-icon>attach_file</mat-icon>
                  </button>
                  <mat-error
                    *ngIf="
                      personalInfoForm.get('secondApplicantPanCard')?.touched &&
                      personalInfoForm
                        .get('secondApplicantPanCard')
                        ?.hasError('required')
                    "
                  >
                    Please upload your Pan Card.
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Profession</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantProfession"
                    type="text"
                  />
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Designation</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantDesignation"
                    type="text"
                  />
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Employed At</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantEmployedAt"
                    type="text"
                  />
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Industry</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantIndustry"
                    type="text"
                  />
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-checkbox
            [checked]="isAddressChecked"
            (change)="onAddressChange($event)"
            style="margin-left: 14px; margin-bottom: 30px"
          >
            Same As Above
          </mat-checkbox>
          <h4
            class="booking-header"
            style="margin-left: 20px; margin-right: 56px"
          >
            Address Details
          </h4>
          <mat-card class="card">
            <mat-card-content class="cpr-mat-card-content scrollable-content">
              <div class="form-row" style="padding-top: 10px">
                <mat-form-field class="cpr-mat-30" appearance="outline">
                  <mat-label>Second Applicant Pin Code</mat-label>
                  <input
                    matInput
                    formControlName="secondApplicantPincode"
                    (input)="onSearchPinCode(secondPincode.value, 'second')"
                    #secondPincode
                    type="text"
                  />

                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantPincode')
                        ?.hasError('required')
                    "
                  >
                    Pin Code is required.
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('secondApplicantPincode')
                        ?.hasError('pattern')
                    "
                  >
                    Pin Code must be a 6-digit number.
                  </mat-error>
                </mat-form-field>

                <div appearance="outline" class="cpr-mat-30">
                  <textarea
                    id="al-otr-rsn"
                    matInput
                    formControlName="secondApplicantAddress1"
                    rows="1"
                    placeholder="Address Line 1"
                    style="
                      flex: 1;
                      width: 100%;
                      padding: 5px 10px;
                      font-size: 13px;
                    "
                    (input)="autoResize()"
                    #textArea
                  ></textarea>
                  <!-- <mat-error *ngIf="personalInfoForm.get('secondApplicantAddress1')?.hasError('required')">
                    Address is required.
                  </mat-error> -->
                </div>

                <div appearance="outline" class="cpr-mat-30">
                  <textarea
                    id="al-otr-rsn"
                    matInput
                    formControlName="secondApplicantAddress2"
                    rows="1"
                    placeholder="Address Line 2"
                    style="
                      flex: 1;
                      width: 100%;
                      padding: 5px 10px;
                      font-size: 13px;
                    "
                    (input)="autoResize()"
                    #textArea
                  ></textarea>
                  <!-- <mat-error *ngIf="personalInfoForm.get('secondApplicantAddress1')?.hasError('required')">
                    Address is required.
                  </mat-error> -->
                </div>

                <!-- <mat-form-field appearance="outline" class="cpr-mat-30">
                  <mat-label>Address Line2</mat-label>
                  <mat-select formControlName="secondApplicantAddress2">
                    <mat-option *ngFor="let city of filteredData['second']?.addresses" [value]="city">
                      {{ city }}
                    </mat-option>
                  </mat-select>
                </mat-form-field> -->
              </div>
              <div class="form-row">
                <mat-form-field appearance="outline" class="cpr-mat-30">
                  <mat-label>City</mat-label>
                  <mat-select formControlName="secondApplicantCity">
                    <mat-option
                      *ngFor="let district of filteredData['second']?.cities"
                      [value]="district"
                    >
                      {{ district }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" class="cpr-mat-30">
                  <mat-label>State</mat-label>
                  <mat-select formControlName="secondApplicantState">
                    <mat-option
                      *ngFor="let state of filteredData['second']?.states"
                      [value]="state"
                    >
                      {{ state }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
          <mat-checkbox
            [checked]="isSecondCoApplicantChecked"
            (change)="onSecondCoApplicantCheckboxChange($event)"
            style="margin-left: 14px; margin-bottom: 30px"
          >
            Add Co-Applicant2 Details
          </mat-checkbox>
        </div>

        <div class="co-applicant-section" *ngIf="isSecondCoApplicantChecked">
          <h4
            class="booking-header"
            style="margin-left: 20px; margin-right: 50px"
          >
            Co Applicant2 Details
          </h4>
          <mat-card class="card" style="margin-bottom: 0px">
            <mat-card-content class="form-card-content">
              <div class="form-row" style="padding-top: 10px">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Salutation</mat-label>
                  <mat-select formControlName="thirdApplicantSalutation">
                    <mat-option
                      *ngFor="let element of salutations"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantSalutation')
                        ?.hasError('required')
                    "
                  >
                    Please select a salutation.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Customer Name</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantName"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantName')
                        ?.hasError('required')
                    "
                  >
                    Customer Name is required
                  </mat-error>
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Date Of Birth</mat-label>
                  <input
                    matInput
                    [matDatepicker]="thirdActualPicker"
                    (click)="thirdActualPicker.open()"
                    formControlName="thirdApplicantDateOfBirth"
                    placeholder="Select Your Date Of Birth"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="thirdActualPicker"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #thirdActualPicker></mat-datepicker>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantDateOfBirth')
                        ?.hasError('required')
                    "
                  >
                    Date of Birth is required.
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantDateOfBirth')
                        ?.hasError('futureDate')
                    "
                  >
                    Date of Birth cannot be in the future.
                  </mat-error>
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Gender</mat-label>
                  <mat-select formControlName="thirdApplicantGender">
                    <!-- <mat-option value=""></mat-option> -->
                    <mat-option
                      *ngFor="let element of gender"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <!-- <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Middle Name</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantMiddleName"
                    type="text"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Last Name</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantLastName"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantLastName')
                        ?.hasError('required')
                    "
                  >
                    First Name is required
                  </mat-error>
                </mat-form-field> -->
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Nationality</mat-label>
                  <mat-select formControlName="thirdApplicantNationality">
                    <!-- <mat-option value=""></mat-option> -->
                    <mat-option
                      *ngFor="let element of nationality"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <!-- <mat-error *ngIf="formData.get('firstApplicantSalutation')?.hasError('required')">
                    Please select one option
                  </mat-error> -->
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Relation To Parent/Spouse</mat-label>
                  <mat-select formControlName="thirdApplicantRelationToParent">
                    <mat-option
                      *ngFor="let element of relationToGuardian"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantRelationToParent')
                        ?.hasError('required')
                    "
                  >
                    Please select a relation to Parent/Spouse.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Salutation</mat-label>
                  <mat-select
                    formControlName="thirdApplicantParentOrSpouseSalutation"
                  >
                    <mat-option
                      *ngFor="let element of salutations"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <mat-error
                    *ngIf="
                      personalInfoForm.get(
                        'thirdApplicantParentOrSpouseSalutation'
                      )?.touched &&
                      personalInfoForm
                        .get('thirdApplicantParentOrSpouseSalutation')
                        ?.hasError('required')
                    "
                  >
                    Please select a salutation.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Parent/Spouse Name</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantParentOrSpouse"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantParentOrSpouse')
                        ?.hasError('required')
                    "
                  >
                    Parent/Spouse Name is required.
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Marital Status</mat-label>
                  <mat-select formControlName="thirdApplicantMaritalStatus">
                    <!-- <mat-option value="">Select Salutation</mat-option> -->
                    <mat-option
                      *ngFor="let element of maritalStatus"
                      [value]="element.commonRefKey"
                    >
                      {{ element.commonRefValue }}
                    </mat-option>
                  </mat-select>
                  <!-- <mat-error *ngIf="formData.get('firstApplicantSalutation')?.hasError('required')">
                    Please select one option
                  </mat-error> -->
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Anniversary Date</mat-label>
                  <input
                    matInput
                    [matDatepicker]="thirdAnniversaryDatePicker"
                    (click)="thirdAnniversaryDatePicker.open()"
                    formControlName="thirdApplicantAnniversaryDate"
                    placeholder="Select Your Anniversary Date"
                  />
                  <mat-datepicker-toggle
                    matSuffix
                    [for]="thirdAnniversaryDatePicker"
                  ></mat-datepicker-toggle>
                  <mat-datepicker #thirdAnniversaryDatePicker></mat-datepicker>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Passport Number</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantPassportNumber"
                    type="text"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Email ID</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantEmail"
                    type="email"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantEmail')
                        ?.hasError('required')
                    "
                  >
                    Email ID is required
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantEmail')
                        ?.hasError('email')
                    "
                  >
                    Please enter a valid email address
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Alternate Email ID</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantAlternateEmail"
                    type="email"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Phone Number</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantPhoneNumber"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm.get('thirdApplicantPhoneNumber')
                        ?.invalid &&
                      personalInfoForm.get('secondApplicantPhoneNumber')
                        ?.touched
                    "
                  >
                    Phone number must be exactly 10 digits.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Alternate Phone Number</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantAlternatePhoneNumber"
                    type="text"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Guardian Name(If Minor)</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantGuardianName"
                    type="text"
                  />
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Aadhar Number</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantAadharNumber"
                    type="text"
                  />
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantAadharNumber')
                        ?.hasError('required')
                    "
                  >
                    Aadhar Number is required
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantAadharNumber')
                        ?.hasError('pattern')
                    "
                  >
                    Aadhar Number must be a 12-digit number
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Aadhar Card</mat-label>
                  <input
                    matInput
                    placeholder="Choose File"
                    type="text"
                    readonly
                    (click)="thirdApplicantAadharCard.click()"
                    [value]="fileNames.thirdApplicantAadharCard || ''"
                    formControlName="thirdApplicantAadharCard"
                  />
                  <input
                    type="file"
                    #thirdApplicantAadharCard
                    (change)="
                      onCheckFileChange($event, 'thirdApplicantAadharCard')
                    "
                    style="display: none"
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    (click)="thirdApplicantAadharCard.click()"
                    type="button"
                  >
                    <mat-icon>attach_file</mat-icon>
                  </button>
                  <mat-error
                    *ngIf="
                      personalInfoForm.get('thirdApplicantAadharCard')
                        ?.touched &&
                      personalInfoForm
                        .get('thirdApplicantAadharCard')
                        ?.hasError('required')
                    "
                  >
                    Please upload your Aadhar Card.
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Pan Number</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantPanNumber"
                    (input)="onPanNumberInput('thirdApplicantPanNumber')"
                  />
                  <mat-error
                    *ngIf="
                      isAdding &&
                      personalInfoForm
                        .get('thirdApplicantPanNumber')
                        ?.hasError('required')
                    "
                  >
                    PAN Number is required
                  </mat-error>
                  <mat-error
                    *ngIf="
                      personalInfoForm
                        .get('thirdApplicantPanNumber')
                        ?.hasError('pattern')
                    "
                  >
                    PAN Number must be in the format ABCDE1234F
                  </mat-error>
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Pan Card</mat-label>
                  <input
                    matInput
                    placeholder="Choose File"
                    type="text"
                    readonly
                    (click)="thirdApplicantPanCard.click()"
                    [value]="fileNames.thirdApplicantPanCard || ''"
                    formControlName="thirdApplicantPanCard"
                  />
                  <input
                    type="file"
                    #thirdApplicantPanCard
                    (change)="
                      onCheckFileChange($event, 'thirdApplicantPanCard')
                    "
                    style="display: none"
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    (click)="thirdApplicantPanCard.click()"
                    type="button"
                  >
                    <mat-icon>attach_file</mat-icon>
                  </button>
                  <mat-error
                    *ngIf="
                      personalInfoForm.get('thirdApplicantPanCard')?.touched &&
                      personalInfoForm
                        .get('thirdApplicantPanCard')
                        ?.hasError('required')
                    "
                  >
                    Please upload your Pan Card.
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Profession</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantProfession"
                    type="text"
                  />
                </mat-form-field>

                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Designation</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantDesignation"
                    type="text"
                  />
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Employed At</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantEmployedAt"
                    type="text"
                  />
                </mat-form-field>
                <mat-form-field class="cpr-mat-25" appearance="outline">
                  <mat-label>Industry</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantIndustry"
                    type="text"
                  />
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-radio-group
            [(ngModel)]="selectedAddressOption"
            style="margin-left: 14px; margin-bottom: 30px"
          >
            <mat-radio-button
              value="firstApplicant"
              (change)="onThirdApplicantAddressChange($event)"
            >
              Same as First Applicant Address
            </mat-radio-button>
            <mat-radio-button
              value="secondApplicant"
              (change)="onThirdApplicantPatchAddressToSecondApplicant($event)"
            >
              Same as Second Applicant Address
            </mat-radio-button>
          </mat-radio-group>

          <h4
            class="booking-header"
            style="margin-left: 20px; margin-right: 56px"
          >
            Address Details
          </h4>
          <mat-card class="card">
            <mat-card-content class="cpr-mat-card-content scrollable-content">
              <div class="form-row" style="padding-top: 10px">
                <mat-form-field class="cpr-mat-30" appearance="outline">
                  <mat-label>Third Applicant Pin Code</mat-label>
                  <input
                    matInput
                    formControlName="thirdApplicantPincode"
                    (input)="onSearchPinCode(thirdPincode.value, 'third')"
                    #thirdPincode
                    type="text"
                  />
                </mat-form-field>
                <div appearance="outline" class="cpr-mat-30">
                  <textarea
                    id="al-otr-rsn"
                    matInput
                    formControlName="thirdApplicantAddress1"
                    rows="1"
                    placeholder="Address Line 1"
                    style="
                      flex: 1;
                      width: 100%;
                      padding: 5px 10px;
                      font-size: 13px;
                    "
                    (input)="autoResize()"
                    #textArea
                  ></textarea>
                  <!-- <mat-error *ngIf="personalInfoForm.get('thirdApplicantAddress1')?.hasError('required')">
                  Address is required.
                </mat-error> -->
                </div>

                <div appearance="outline" class="cpr-mat-30">
                  <textarea
                    id="al-otr-rsn"
                    matInput
                    formControlName="thirdApplicantAddress2"
                    rows="1"
                    placeholder="Address Line 2"
                    style="
                      flex: 1;
                      width: 100%;
                      padding: 5px 10px;
                      font-size: 13px;
                    "
                    (input)="autoResize()"
                    #textArea
                  ></textarea>
                  <!-- <mat-error *ngIf="personalInfoForm.get('thirdApplicantAddress1')?.hasError('required')">
                  Address is required.
                </mat-error> -->
                </div>
                <!-- 
                <mat-form-field appearance="outline" class="cpr-mat-30">
                  <mat-label>Address Line2</mat-label>
                  <mat-select formControlName="thirdApplicantAddress2">
                    <mat-option *ngFor="let city of filteredData['third']?.addresses" [value]="city">
                      {{ city }}
                    </mat-option>
                  </mat-select>
                </mat-form-field> -->
              </div>
              <div class="form-row">
                <mat-form-field appearance="outline" class="cpr-mat-30">
                  <mat-label>City</mat-label>
                  <mat-select formControlName="thirdApplicantCity">
                    <mat-option
                      *ngFor="let district of filteredData['third']?.cities"
                      [value]="district"
                    >
                      {{ district }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" class="cpr-mat-30">
                  <mat-label>State</mat-label>
                  <mat-select formControlName="thirdApplicantState">
                    <mat-option
                      *ngFor="let state of filteredData['third']?.states"
                      [value]="state"
                    >
                      {{ state }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <div>
        <mat-checkbox
          [checked]="isDescriptionChecked"
          (change)="onDescriptionChange($event)"
          style="margin-left: 14px; margin-bottom: 30px"
        >
          Is the sales team committed to any additional changes?
        </mat-checkbox>
        <div
          class="co-applicant-section"
          *ngIf="isDescriptionChecked"
          style="width: 100%"
        >
          <mat-card class="card" style="margin-bottom: 0px; width: 100%">
            <mat-card-content class="form-card-content" style="padding: 0">
              <div class="form-row" style="padding: 10px 0; width: 100%">
                <div class="description-container" style="width: 100%">
                  <textarea
                    matInput
                    formControlName="description"
                    rows="4"
                    placeholder="Enter the description of the changes the sales team has committed to"
                    style="
                      width: 100%;
                      padding: 8px;
                      border-radius: 4px;
                      border: 1px solid #ccc;
                      font-size: 14px;
                    "
                    (input)="autoResize()"
                    #textArea
                  ></textarea>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <div class="bank">
        <h4 class="booking-header">Loan Bank Details</h4>
        <mat-card class="card" style="padding: 0px; margin-bottom: 0px">
          <mat-card-content class="form-card-content">
            <div class="form-row" style="padding-top: 10px">
              <mat-form-field appearance="outline">
                <mat-label>Search/Select Loan Bank</mat-label>
                <input
                  type="text"
                  matInput
                  (input)="searchBank($event)"
                  [formControl]="bank"
                  [matAutocomplete]="bankAuto"
                />
                <mat-autocomplete
                  #bankAuto="matAutocomplete"
                  (optionSelected)="onBankSelect($event)"
                  [displayWith]="displayBanks"
                >
                  <mat-option *ngFor="let option of bankNames" [value]="option">
                    {{ option.commonRefValue }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <mat-form-field class="cpr-mat-25" appearance="outline">
                <mat-label>Sanction Letter</mat-label>
                <input
                  matInput
                  placeholder="Choose File"
                  type="text"
                  readonly
                  (click)="sanctionLetter.click()"
                  [value]="fileNames.sanctionLetter || ''"
                  formControlName="sanctionLetter"
                />
                <input
                  type="file"
                  #sanctionLetter
                  (change)="onCheckFileChange($event, 'sanctionLetter')"
                  style="display: none"
                />
                <button
                  mat-icon-button
                  matSuffix
                  (click)="sanctionLetter.click()"
                  type="button"
                >
                  <mat-icon>attach_file</mat-icon>
                </button>
                <mat-error
                  *ngIf="
                    personalInfoForm.get('secondApplicantAadharCard')
                      ?.touched &&
                    personalInfoForm
                      .get('secondApplicantAadharCard')
                      ?.hasError('required')
                  "
                >
                  Please upload your Aadhar Card.
                </mat-error>
              </mat-form-field>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      <div>
        <mat-card-footer
          class="add-mat-card-footer"
          style="margin: 10px 15px; justify-content: flex-start"
        >
          <div style="padding-bottom: 20px">
            <button
              mat-flat-button
              class="btn-class accent"
              matStepperPrevious
              type="button"
            >
              BACK
            </button>
            <button
              *ngIf="isAdding"
              mat-flat-button
              class="btn-class warn"
              (click)="clearForm()"
              type="button"
            >
              RESET
            </button>
            <button
              mat-flat-button
              class="btn-class primary"
              type="button"
              (click)="onSubmit(stepper)"
            >
              SAVE & NEXT
            </button>
          </div>
        </mat-card-footer>
        <!-- <button mat-button matStepperNext [disabled]="personalInfoForm.invalid">
          Next
        </button> -->
        <!-- <button
            *ngIf="isAdding"
            mat-flat-button
            class="btn-class warn"
            (click)="clearForm()"
            type="button"
          >
            RESET
          </button> -->

        <!-- <button
        flat-mat-button
        class="btn-class primary"
        type="submit"
        (click)="save()"
        matStepperNext
        [disabled]="personalInfoForm.invalid"
      >
        Save
      </button> -->
      </div>
    </form>
    <!-- <div *ngIf="loading" class="loading-overlay">
      <mat-spinner></mat-spinner>
    </div> -->
  </mat-step>

  <mat-step [stepControl]="StagesInfoForm" label="Stage Details">
    <form [formGroup]="StagesInfoForm">
      <table
        matSort
        mat-table
        [dataSource]="customerStagesDto"
        class="mat-elevation-z8 full-width-table"
      >
        <!-- Stage Order -->
        <ng-container matColumnDef="stageOrder">
          <th mat-header-cell *matHeaderCellDef>Stage Order</th>
          <td mat-cell *matCellDef="let stage">{{ stage.stageOrder }}</td>
          <td mat-footer-cell *matFooterCellDef>
            <!-- <strong>Total</strong> -->
          </td>
        </ng-container>

        <ng-container matColumnDef="stageName">
          <th mat-header-cell *matHeaderCellDef>Stage Name</th>
          <td mat-cell *matCellDef="let stage">{{ stage.stageName }}</td>
          <td mat-footer-cell *matFooterCellDef>
            <strong>Total</strong>
          </td>
        </ng-container>

        <!-- Percentage -->
        <ng-container matColumnDef="percentage">
          <th mat-header-cell *matHeaderCellDef>Percentage(%)</th>
          <td mat-cell *matCellDef="let stage">{{ stage.percentage }}</td>
          <td mat-footer-cell *matFooterCellDef>
            <strong>{{ customerStagesDtoWithAmount.totalPercentage }}%</strong>
          </td>
        </ng-container>

        <!-- Payable Amount -->
        <ng-container matColumnDef="expectedAmount">
          <th mat-header-cell *matHeaderCellDef>Payable Amount</th>
          <td mat-cell *matCellDef="let stage">
            {{ stage.formattedExpectedAmount }}
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <strong>{{
              customerStagesDtoWithAmount.formattedTotalExpectedAmount
            }}</strong>
          </td>
        </ng-container>

        <!-- TDS -->
        <ng-container matColumnDef="tds">
          <th mat-header-cell *matHeaderCellDef>TDS</th>
          <td mat-cell *matCellDef="let stage">
            {{ stage.formattedTdsAmount }}
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <strong>{{ customerStagesDtoWithAmount.formattedTotalTds }}</strong>
          </td>
        </ng-container>

        <!-- Net Payable Amount -->
        <ng-container matColumnDef="netPayableAmount">
          <th mat-header-cell *matHeaderCellDef>Net Payable Amount</th>
          <td mat-cell *matCellDef="let stage">
            {{ stage.formattedNetPayableAmount }}
          </td>
          <td mat-footer-cell *matFooterCellDef>
            <strong>{{
              customerStagesDtoWithAmount.formattedTotalNetPayableAmount
            }}</strong>
          </td>
        </ng-container>

        <!-- Table Rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
      </table>

      <!-- Navigation Buttons -->
      <div id="stages-form" class="button-group">
        <button
          mat-flat-button
          class="btn-class accent"
          matStepperPrevious
          type="button"
        >
          BACK
        </button>
        <button
          mat-flat-button
          class="btn-class primary"
          matStepperNext
          type="submit"
        >
          SAVE & NEXT
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="paymentForm" label="Payment">
    <booking-form-adding-payment
      (saveAndNext)="stepper.next()"
      [bookingId]="getBookingId()"
    ></booking-form-adding-payment>
  </mat-step>

  <mat-step [stepControl]="pdfUploadForm" label="Upload Booking Form">
    <form [formGroup]="pdfUploadForm" (ngSubmit)="uploadBookingForm()">
      <mat-card class="card">
        <mat-card-content class="cpr-mat-card-content">
          <div class="custom-file-upload">
            <input
              type="file"
              accept=".pdf"
              formControlName="pdfFile"
              (change)="onFileChange($event)"
            />
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card-footer
        class="add-mat-card-footer"
        style="margin: 10px 15px; justify-content: flex-start"
      >
        <div style="padding-bottom: 20px">
          <button
            mat-flat-button
            class="btn-class accent"
            matStepperPrevious
            type="button"
          >
            BACK
          </button>
          <button
            mat-flat-button
            class="btn-class primary"
            [disabled]="!pdfUploadForm.valid"
            type="submit"
            matStepperNext
          >
            SAVE
          </button>
        </div>
      </mat-card-footer>
    </form>
  </mat-step>
</mat-vertical-stepper>
