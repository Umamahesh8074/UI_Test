<div class="header">CLIENT INVOICE REPORT</div>
<div class="dci-search-container">
  <div class="dci-button-row">
    <!-- <mat-form-field appearance="outline" class="mat-45">
      <mat-label>Select Client</mat-label>
      <mat-select (selectionChange)="onselectClientName($event)">
        <mat-option value="">All</mat-option>
        <mat-option
          *ngFor="let monthlyInvoiceReport of clients"
          [value]="monthlyInvoiceReport.projectLocation"
        >
          {{ monthlyInvoiceReport.projectLocation }}
        </mat-option>
      </mat-select>
      
    </mat-form-field> -->

    <mat-form-field
      appearance="outline"
      class="display-reports-search-class"
      style="margin-left: 30px"
    >
      <mat-label>Search/Select Project</mat-label>
      <input
        type="text"
        matInput
        [value]="
          selectedProjectLocation.projectLocation
            ? selectedProjectLocation.projectLocation
            : ''
        "
        (input)="searchProjectLocation($event)"
        [formControl]="projectLocationFc"
        [matAutocomplete]="projectAuto"
      />
      <mat-autocomplete
        #projectAuto="matAutocomplete"
        (optionSelected)="onselectClientName($event)"
        [displayWith]="displayProject"
      >
        <mat-option value="">All</mat-option>
        <mat-option *ngFor="let option of clients" [value]="option">
          {{ option.projectLocation }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <mat-form-field
      appearance="outline"
      class="display-reports-search-class"
      style="margin-left: 30px; margin-right: 30px"
    >
      <mat-label>Role</mat-label>
      <mat-select
        formControlName="serviceName"
        (selectionChange)="onselectServiceName($event)"
      >
        <mat-option value="">All</mat-option>
        <mat-option
          *ngFor="let item of roles"
          [value]="item.roleName"
          [disabled]="isView"
        >
          {{ item.roleName }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- <mat-form-field appearance="outline" class="mat-45">
      <mat-label>Year</mat-label>
      <mat-select formControlName="year" (selectionChange)="onSelectYear($event)">
        <mat-option
          *ngFor="let item of consumptionYearList"
          [value]="item.commonRefValue"
          [disabled]="isView"
        >
          {{ item.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="mat-45">
      <mat-label>Month</mat-label>
      <mat-select
      
        [(value)]="selectedDay"
        (selectionChange)="onSelectMonth($event)"
      >
        <mat-option *ngFor="let item of months" [value]="item.id" [disabled]="isView">
          {{ item.value }}
        </mat-option>
      </mat-select>
    </mat-form-field> -->

    <mat-form-field appearance="outline" class="mat-45">
      <mat-label>Year</mat-label>
      <mat-select
        formControlName="year"
        [(value)]="selectedYear"
        (selectionChange)="onSelectYear($event)"
      >
        <mat-option
          *ngFor="let item of consumptionYearList"
          [value]="item.commonRefValue"
          [disabled]="isView"
        >
          {{ item.commonRefValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="mat-45">
      <mat-label>Month</mat-label>
      <mat-select
        [(value)]="selectedMonth"
        (selectionChange)="onSelectMonth($event)"
      >
        <mat-option
          *ngFor="let item of months"
          [value]="item.id"
          [disabled]="isView"
        >
          {{ item.value }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      (click)="onClear()"
      class="mr-10 clr-button clear-top1 clr-btn-color"
      style="margin-left: 30px"
    >
      Clear
    </button>
    <!-- <button mat-flat-button style="width: 25%; background-color: green; color: white;" class="btn-class" (click)="generateInvoice()">
      <mat-icon>file_copy</mat-icon>
      Generate Current Month Invoices
    </button> -->

    <button
      mat-flat-button
      style="background-color: green; color: white; margin-left: 20px"
      class="btn-class"
      (click)="generateInvoice(selectedMonth, selectedYear)"
    >
      <mat-icon>file_copy</mat-icon>
      Generate All Invoices
    </button>

    <div
      *ngIf="monthlyGrandTotal !== 0 && monthlyGrandTotal"
      class="grand-total-box"
    >
      <h3>Monthly Grand Total: {{ monthlyGrandTotal | indianCurrency }}</h3>
    </div>
  </div>
</div>

<!-- <div class="example-button-row" *ngIf="flag">
  <span><strong>Client Name : </strong> {{ clientName}}</span>

  </div> -->
<mat-card class="cmn-card">
  <mat-card-content class="cmn-card-content">
    <div *ngIf="flag">
      <mat-nav-list>
        <ng-container
          *ngFor="let data of monthlyInvoiceReportData; let i = index"
        >
          <mat-list-item class="main-header" (click)="toggle(i)">
            <div class="list-item-content">
              <mat-icon class="menu-icon">description</mat-icon>
              <span mat-subheader class="menu-head">
                <span class="label">{{ data.projectLocation }}</span>
                <span class="info">
                  <span class="service-salary">
                    <strong>Service Salary: </strong
                    >{{ data.grandTotal | indianCurrency }}
                  </span>
                  <span class="service-salary">
                    <strong>Month: </strong>{{ data.month | fullMonthName }}
                  </span>

                  <mat-icon class="toggle-icon">
                    {{
                      expandedIndex.includes(i)
                        ? "expand_more"
                        : "chevron_right"
                    }}
                  </mat-icon>
                </span>
              </span>
            </div>
          </mat-list-item>
          <ng-container *ngIf="expandedIndex.includes(i)">
            <div class="container" style="border: 1px solid #dedbdb">
              <h4 style="margin-top: 10px">
                <strong>Consumption Details</strong>
              </h4>
              <div class="mat-elevation-z8">
                <table
                  mat-table
                  [dataSource]="data.invoices"
                  matSort
                  class="mat-table"
                >
                  <ng-container matColumnDef="id">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Id
                    </th>
                    <td mat-cell *matCellDef="let element; let i = index">
                      {{ i + 1 }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="clientName">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Client Name
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.clientName }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="location">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Location
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.location }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="serviceName">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Service Name
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.serviceName }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="manPower">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Man Power
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.manPower }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="serviceSalary">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Service Salary
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.serviceSalary }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="invoiceDate">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Invoice Date
                    </th>
                    <td mat-cell *matCellDef="let element">
                      {{ element.invoiceDate }}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="actions">
                    <th
                      mat-header-cell
                      *matHeaderCellDef
                      style="background-color: #004869; color: white"
                    >
                      Actions
                    </th>
                    <td mat-cell *matCellDef="let monthlyInvoiceReportData">
                      <i
                        class="bi bi-pencil action-icon"
                        (click)="
                          viewClientInvoiceReport(i, monthlyInvoiceReportData)
                        "
                      ></i>
                      <i
                        (click)="
                          openConfirmDialog(
                            monthlyInvoiceReportData.clientInvoiceReportId
                          )
                        "
                        class="bi bi-trash text-danger action-icon"
                        style="color: red"
                      ></i>
                      <!-- <i
                      (click)="
                        viewClientInvoiceReport(monthlyInvoiceReportData)
                      "
                      class="bi bi-eye text-primary action-icon"
                      style="color: blue"
                    ></i> -->
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumns"
                  ></tr>
                </table>
              </div>

              <button
                mat-flat-button
                style="
                  background-color: rgb(97, 97, 38);
                  color: white;
                  margin: 15px 0px;
                "
                class="btn-class"
                (click)="onClickGenerateExcel(data)"
              >
                Generate
              </button>
            </div>
            <mat-card-footer></mat-card-footer>
          </ng-container>
        </ng-container>
      </mat-nav-list>
    </div>

    <div *ngIf="!flag" class="no-invoices">
      <h4>No Monthly Invoices</h4>
    </div>
  </mat-card-content>
  <mat-card-footer>
    <mat-paginator
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons
    ></mat-paginator>
  </mat-card-footer>
</mat-card>
